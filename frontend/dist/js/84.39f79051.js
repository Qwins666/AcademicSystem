"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[84],{1680:function(e,l,a){a.d(l,{$U:function(){return i},Ab:function(){return o},UM:function(){return r},dy:function(){return d},qN:function(){return n},uk:function(){return u}});var t=a(86);function n(e={}){return(0,t.A)({url:"/achievements",method:"get",params:e})}function r(e){return(0,t.A)({url:`/achievements/${e}`,method:"get"})}function o(e){return(0,t.A)({url:"/achievements",method:"post",data:e})}function i(e,l){return(0,t.A)({url:`/achievements/${e}`,method:"put",data:l})}function d(e){return(0,t.A)({url:`/achievements/${e}`,method:"delete"})}function u(e){return(0,t.A)({url:`/achievements/submitter/${e}`,method:"get"})}},4084:function(e,l,a){a.r(l),a.d(l,{default:function(){return h}});var t=a(641),n=a(33),r=a(3751);const o={class:"achievement-form"},i={class:"page-header"},d={class:"form-container"};function u(e,l,a,u,s,c){const m=(0,t.g2)("ArrowLeft"),p=(0,t.g2)("el-icon"),f=(0,t.g2)("el-button"),g=(0,t.g2)("el-input"),b=(0,t.g2)("el-form-item"),h=(0,t.g2)("el-option"),v=(0,t.g2)("el-select"),k=(0,t.g2)("upload-filled"),F=(0,t.g2)("el-upload"),_=(0,t.g2)("el-form");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.Lk)("div",i,[(0,t.Lk)("h1",null,(0,n.v_)(u.isEdit?"编辑成果":"申报成果"),1),(0,t.bF)(f,{onClick:u.handleBack},{default:(0,t.k6)(()=>[(0,t.bF)(p,null,{default:(0,t.k6)(()=>[(0,t.bF)(m)]),_:1}),l[5]||(l[5]=(0,t.eW)(" 返回 ",-1))]),_:1},8,["onClick"])]),(0,t.Lk)("div",d,[(0,t.bF)(_,{ref:"formRef",model:u.form,rules:u.rules,"label-width":"120px",onSubmit:(0,r.D$)(u.handleSubmit,["prevent"])},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"成果标题",prop:"title"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{modelValue:u.form.title,"onUpdate:modelValue":l[0]||(l[0]=e=>u.form.title=e),placeholder:"请输入成果标题",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"成果类型",prop:"type"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:u.form.type,"onUpdate:modelValue":l[1]||(l[1]=e=>u.form.type=e),placeholder:"请选择成果类型",style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(h,{label:"论文",value:"PAPER"}),(0,t.bF)(h,{label:"专利",value:"PATENT"}),(0,t.bF)(h,{label:"证书",value:"CERTIFICATE"}),(0,t.bF)(h,{label:"项目",value:"PROJECT"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"成果描述",prop:"description"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{modelValue:u.form.description,"onUpdate:modelValue":l[2]||(l[2]=e=>u.form.description=e),type:"textarea",rows:4,placeholder:"请输入成果描述",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"成果级别",prop:"level"},{default:(0,t.k6)(()=>[(0,t.bF)(v,{modelValue:u.form.level,"onUpdate:modelValue":l[3]||(l[3]=e=>u.form.level=e),placeholder:"请选择成果级别",style:{width:"100%"}},{default:(0,t.k6)(()=>[(0,t.bF)(h,{label:"国家级",value:"NATIONAL"}),(0,t.bF)(h,{label:"省级",value:"PROVINCIAL"}),(0,t.bF)(h,{label:"校级",value:"SCHOOL"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"标签"},{default:(0,t.k6)(()=>[(0,t.bF)(g,{modelValue:u.form.tags,"onUpdate:modelValue":l[4]||(l[4]=e=>u.form.tags=e),placeholder:"请输入标签，多个标签用逗号分隔",maxlength:"500"},null,8,["modelValue"])]),_:1}),(0,t.bF)(b,{label:"成果文件",prop:"file"},{default:(0,t.k6)(()=>[(0,t.bF)(F,{ref:"uploadRef","auto-upload":!1,"on-change":u.handleFileChange,"before-upload":u.beforeUpload,"file-list":u.fileList,accept:".pdf,.doc,.docx,.jpg,.jpeg,.png",drag:""},{tip:(0,t.k6)(()=>[...l[6]||(l[6]=[(0,t.Lk)("div",{class:"el-upload__tip"}," 支持 PDF、Word、图片格式，文件大小不超过10MB ",-1)])]),default:(0,t.k6)(()=>[(0,t.bF)(p,{class:"el-icon--upload"},{default:(0,t.k6)(()=>[(0,t.bF)(k)]),_:1}),l[7]||(l[7]=(0,t.Lk)("div",{class:"el-upload__text"},[(0,t.eW)(" 将文件拖到此处，或"),(0,t.Lk)("em",null,"点击上传")],-1))]),_:1},8,["on-change","before-upload","file-list"])]),_:1}),(0,t.bF)(b,null,{default:(0,t.k6)(()=>[(0,t.bF)(f,{type:"primary",loading:u.loading,onClick:u.handleSubmit},{default:(0,t.k6)(()=>[(0,t.eW)((0,n.v_)(u.isEdit?"更新":"提交"),1)]),_:1},8,["loading","onClick"]),(0,t.bF)(f,{onClick:u.handleReset},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.eW)("重置",-1)])]),_:1},8,["onClick"]),(0,t.bF)(f,{onClick:u.handleBack},{default:(0,t.k6)(()=>[...l[9]||(l[9]=[(0,t.eW)("取消",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","onSubmit"])])])}var s=a(953),c=a(5220),m=a(163),p=a(1680),f={name:"AchievementForm",setup(){const e=(0,c.rd)(),l=(0,c.lq)(),a=(0,s.KR)(),n=(0,s.KR)(),r=(0,s.KR)(!1),o=(0,s.KR)([]),i=(0,t.EW)(()=>!!l.params.id),d=(0,s.Kh)({title:"",type:"",description:"",level:"",tags:"",file:null}),u={title:[{required:!0,message:"请输入成果标题",trigger:"blur"},{min:2,max:200,message:"标题长度在2到200个字符",trigger:"blur"}],type:[{required:!0,message:"请选择成果类型",trigger:"change"}],description:[{required:!0,message:"请输入成果描述",trigger:"blur"},{min:10,max:1e3,message:"描述长度在10到1000个字符",trigger:"blur"}],level:[{required:!0,message:"请选择成果级别",trigger:"change"}]},f=async()=>{if(i.value)try{const e=l.params.id,a=await(0,p.UM)(e);if(a.data){const e=a.data;Object.assign(d,{title:e.title||"",type:e.type||"",description:e.description||"",level:e.level||"",tags:e.tags||""})}}catch(e){console.error("加载成果数据失败:",e),m.nk.error("加载成果数据失败")}},g=(e,l)=>{d.file=e.raw},b=e=>{const l=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","image/jpeg","image/png"].includes(e.type),a=e.size/1024/1024<10;return l?(a||m.nk.error("文件大小不能超过 10MB!"),!1):(m.nk.error("只能上传 PDF、Word、图片格式的文件!"),!1)},h=async()=>{a.value&&await a.value.validate(async a=>{if(a){if(!d.file&&!i.value)return void m.nk.warning("请上传成果文件");r.value=!0;try{const a={title:d.title,type:d.type,description:d.description,level:d.level,tags:d.tags||""};let n;if(i.value)n=await(0,p.$U)(l.params.id,a),m.nk.success("成果更新成功");else if(n=await(0,p.Ab)(a),m.nk.success("成果提交成功"),d.file&&n.data&&n.data.id)try{const e=new FormData;e.append("file",d.file),e.append("achievementId",n.data.id)}catch(t){console.error("文件上传失败:",t),m.nk.warning("成果提交成功，但文件上传失败，请稍后手动上传")}e.push("/dashboard/achievements")}catch(n){console.error("操作失败:",n);const e=n.response?.data?.message||n.message||(i.value?"更新成果失败":"提交成果失败");m.nk.error(e)}finally{r.value=!1}}})},v=()=>{a.value&&a.value.resetFields(),o.value=[],d.file=null},k=()=>{e.push("/dashboard/achievements")};return(0,t.sV)(()=>{f()}),{formRef:a,uploadRef:n,loading:r,fileList:o,isEdit:i,form:d,rules:u,handleFileChange:g,beforeUpload:b,handleSubmit:h,handleReset:v,handleBack:k}}},g=a(6262);const b=(0,g.A)(f,[["render",u],["__scopeId","data-v-e819a1ae"]]);var h=b}}]);
//# sourceMappingURL=84.39f79051.js.map