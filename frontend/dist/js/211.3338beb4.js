"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[211],{1680:function(e,a,t){t.d(a,{$U:function(){return u},Ab:function(){return o},UM:function(){return r},dy:function(){return s},qN:function(){return n},uk:function(){return i}});var l=t(86);function n(e={}){return(0,l.A)({url:"/achievements",method:"get",params:e})}function r(e){return(0,l.A)({url:`/achievements/${e}`,method:"get"})}function o(e){return(0,l.A)({url:"/achievements",method:"post",data:e})}function u(e,a){return(0,l.A)({url:`/achievements/${e}`,method:"put",data:a})}function s(e){return(0,l.A)({url:`/achievements/${e}`,method:"delete"})}function i(e){return(0,l.A)({url:`/achievements/submitter/${e}`,method:"get"})}},3211:function(e,a,t){t.r(a),t.d(a,{default:function(){return A}});var l=t(641),n=t(33);const r={class:"achievement-list"},o={class:"page-header"},u={class:"search-container"},s={class:"table-container"},i={class:"pagination-container"},c={key:0},d={class:"dialog-footer"};function p(e,a,t,p,m,v){const g=(0,l.g2)("Plus"),h=(0,l.g2)("el-icon"),b=(0,l.g2)("el-button"),k=(0,l.g2)("el-input"),f=(0,l.g2)("el-form-item"),N=(0,l.g2)("el-option"),F=(0,l.g2)("el-select"),E=(0,l.g2)("Search"),A=(0,l.g2)("Refresh"),y=(0,l.g2)("el-form"),C=(0,l.g2)("el-table-column"),_=(0,l.g2)("el-tag"),w=(0,l.g2)("el-table"),T=(0,l.g2)("el-pagination"),I=(0,l.g2)("el-radio"),P=(0,l.g2)("el-radio-group"),D=(0,l.g2)("el-dialog"),R=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",r,[(0,l.Lk)("div",o,[a[9]||(a[9]=(0,l.Lk)("h1",null,"成果申报",-1)),p.hasPermission(["STUDENT"])?((0,l.uX)(),(0,l.Wv)(b,{key:0,type:"primary",onClick:p.handleCreate},{default:(0,l.k6)(()=>[(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.bF)(g)]),_:1}),a[8]||(a[8]=(0,l.eW)(" 申报成果 ",-1))]),_:1},8,["onClick"])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",u,[(0,l.bF)(y,{model:p.searchForm,inline:""},{default:(0,l.k6)(()=>[(0,l.bF)(f,{label:"成果标题"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{modelValue:p.searchForm.title,"onUpdate:modelValue":a[0]||(a[0]=e=>p.searchForm.title=e),placeholder:"请输入成果标题",clearable:""},null,8,["modelValue"])]),_:1}),(0,l.bF)(f,{label:"成果类型"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{modelValue:p.searchForm.type,"onUpdate:modelValue":a[1]||(a[1]=e=>p.searchForm.type=e),style:{width:"120px"},placeholder:"请选择类型",clearable:""},{default:(0,l.k6)(()=>[(0,l.bF)(N,{label:"论文",value:"PAPER"}),(0,l.bF)(N,{label:"专利",value:"PATENT"}),(0,l.bF)(N,{label:"证书",value:"CERTIFICATE"}),(0,l.bF)(N,{label:"项目",value:"PROJECT"})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(f,{label:"审核状态"},{default:(0,l.k6)(()=>[(0,l.bF)(F,{modelValue:p.searchForm.status,"onUpdate:modelValue":a[2]||(a[2]=e=>p.searchForm.status=e),style:{width:"120px"},placeholder:"请选择状态",clearable:""},{default:(0,l.k6)(()=>[(0,l.bF)(N,{label:"待审核",value:"PENDING"}),(0,l.bF)(N,{label:"待终审",value:"PENDING_FINAL"}),(0,l.bF)(N,{label:"已通过",value:"APPROVED"}),(0,l.bF)(N,{label:"已驳回",value:"REJECTED"})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(f,null,{default:(0,l.k6)(()=>[(0,l.bF)(b,{type:"primary",onClick:p.handleSearch},{default:(0,l.k6)(()=>[(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.bF)(E)]),_:1}),a[10]||(a[10]=(0,l.eW)(" 搜索 ",-1))]),_:1},8,["onClick"]),(0,l.bF)(b,{onClick:p.handleReset},{default:(0,l.k6)(()=>[(0,l.bF)(h,null,{default:(0,l.k6)(()=>[(0,l.bF)(A)]),_:1}),a[11]||(a[11]=(0,l.eW)(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,l.Lk)("div",s,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(w,{data:p.achievementList},{default:(0,l.k6)(()=>[(0,l.bF)(C,{prop:"title",label:"成果标题","min-width":"150"}),(0,l.bF)(C,{prop:"type",label:"类型",width:"130"},{default:(0,l.k6)(e=>[(0,l.bF)(_,{type:p.getTypeTag(e.row.type)},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(p.getTypeName(e.row.type)),1)]),_:2},1032,["type"])]),_:1}),(0,l.bF)(C,{prop:"level",label:"级别",width:"120"},{default:(0,l.k6)(e=>[e.row.level?((0,l.uX)(),(0,l.Wv)(_,{key:0,type:p.getLevelTag(e.row.level)},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(p.getLevelName(e.row.level)),1)]),_:2},1032,["type"])):(0,l.Q3)("",!0)]),_:1}),(0,l.bF)(C,{prop:"submitterName",label:"提交者",width:"120"}),(0,l.bF)(C,{prop:"createTime",label:"提交时间",width:"180"}),(0,l.bF)(C,{prop:"status",label:"状态",width:"100"},{default:(0,l.k6)(e=>[(0,l.bF)(_,{type:p.getStatusTag(e.row.status)},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(p.getStatusName(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,l.bF)(C,{label:"操作",width:"200",fixed:"right"},{default:(0,l.k6)(e=>[(0,l.bF)(b,{type:"primary",size:"small",onClick:a=>p.handleView(e.row)},{default:(0,l.k6)(()=>[...a[12]||(a[12]=[(0,l.eW)(" 查看 ",-1)])]),_:1},8,["onClick"]),p.canEdit(e.row)?((0,l.uX)(),(0,l.Wv)(b,{key:0,type:"warning",size:"small",onClick:a=>p.handleEdit(e.row)},{default:(0,l.k6)(()=>[...a[13]||(a[13]=[(0,l.eW)(" 编辑 ",-1)])]),_:1},8,["onClick"])):(0,l.Q3)("",!0),p.canApprove(e.row)?((0,l.uX)(),(0,l.Wv)(b,{key:1,type:"success",size:"small",onClick:a=>p.handleApprove(e.row)},{default:(0,l.k6)(()=>[(0,l.eW)((0,n.v_)(p.getApprovalButtonText(e.row)),1)]),_:2},1032,["onClick"])):(0,l.Q3)("",!0),p.hasPermission(["ADMIN"])&&"PENDING"===e.row.status&&!p.canApprove(e.row)?((0,l.uX)(),(0,l.Wv)(b,{key:2,type:"info",size:"small",disabled:""},{default:(0,l.k6)(()=>[...a[14]||(a[14]=[(0,l.eW)(" 待初审 ",-1)])]),_:1})):(0,l.Q3)("",!0),p.canDelete(e.row)?((0,l.uX)(),(0,l.Wv)(b,{key:3,type:"danger",size:"small",onClick:a=>p.handleDelete(e.row)},{default:(0,l.k6)(()=>[...a[15]||(a[15]=[(0,l.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,l.Q3)("",!0)]),_:1})]),_:1},8,["data"])),[[R,p.loading]]),(0,l.Lk)("div",i,[(0,l.bF)(T,{"current-page":p.pagination.current,"onUpdate:currentPage":a[3]||(a[3]=e=>p.pagination.current=e),"page-size":p.pagination.size,"onUpdate:pageSize":a[4]||(a[4]=e=>p.pagination.size=e),total:p.pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p.handleSizeChange,onCurrentChange:p.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),(0,l.bF)(D,{modelValue:p.approvalDialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>p.approvalDialogVisible=e),title:`${"PENDING"===p.currentAchievement?.status?"初审":"终审"}成果: ${p.currentAchievement?.title}`,width:"500px",class:"approval-dialog"},{footer:(0,l.k6)(()=>[(0,l.Lk)("div",d,[(0,l.bF)(b,{onClick:p.closeApprovalDialog},{default:(0,l.k6)(()=>[...a[18]||(a[18]=[(0,l.eW)("取消",-1)])]),_:1},8,["onClick"]),(0,l.bF)(b,{type:"primary",onClick:p.submitApproval},{default:(0,l.k6)(()=>[...a[19]||(a[19]=[(0,l.eW)("确认",-1)])]),_:1},8,["onClick"])])]),default:(0,l.k6)(()=>[p.currentAchievement?((0,l.uX)(),(0,l.CE)("div",c,[(0,l.bF)(y,{model:p.approvalForm,"label-width":"80px"},{default:(0,l.k6)(()=>[(0,l.bF)(f,{label:"审核结果"},{default:(0,l.k6)(()=>[(0,l.bF)(P,{modelValue:p.approvalForm.approved,"onUpdate:modelValue":a[5]||(a[5]=e=>p.approvalForm.approved=e)},{default:(0,l.k6)(()=>[(0,l.bF)(I,{label:!0},{default:(0,l.k6)(()=>[...a[16]||(a[16]=[(0,l.eW)("通过",-1)])]),_:1}),(0,l.bF)(I,{label:!1},{default:(0,l.k6)(()=>[...a[17]||(a[17]=[(0,l.eW)("驳回",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(f,{label:"审核意见"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{modelValue:p.approvalForm.comment,"onUpdate:modelValue":a[6]||(a[6]=e=>p.approvalForm.comment=e),type:"textarea",rows:4,placeholder:"请输入审核意见"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):(0,l.Q3)("",!0)]),_:1},8,["modelValue","title"])])])}var m=t(953),v=t(5220),g=t(6278),h=t(163),b=t(7918),k=t(1680),f=t(86),N={name:"AchievementList",setup(){const e=(0,v.rd)(),a=(0,g.Pj)(),t=(0,m.KR)(!1),n=(0,m.KR)([]),r=(0,m.KR)(new Map),o=(0,m.Kh)({title:"",type:"",status:""}),u=(0,m.Kh)({current:1,size:10,total:0}),s=(0,l.EW)(()=>a.getters.userRole),i=(0,l.EW)(()=>a.getters.user?.id),c=(0,m.KR)(!1),d=(0,m.KR)(null),p=(0,m.Kh)({approved:!0,comment:""}),N=e=>e.includes(s.value),F=e=>{const a={PAPER:"论文",PATENT:"专利",CERTIFICATE:"证书",PROJECT:"项目"};return a[e]||e},E=e=>{const a={PAPER:"primary",PATENT:"success",CERTIFICATE:"warning",PROJECT:"info"};return a[e]||"info"},A=e=>{const a={NATIONAL:"国家级",PROVINCIAL:"省级",SCHOOL:"校级"};return a[e]||e},y=e=>{const a={NATIONAL:"danger",PROVINCIAL:"warning",SCHOOL:"success"};return a[e]||"info"},C=e=>{const a={PENDING:"待审核",PENDING_FINAL:"待终审",APPROVED:"已通过",REJECTED:"已驳回"};return a[e]||e},_=e=>{const a={PENDING:"warning",PENDING_FINAL:"success",APPROVED:"success",REJECTED:"danger"};return a[e]||"info"},w=e=>N(["STUDENT"])&&e.submitterId===i.value&&"PENDING"===e.status,T=e=>!(!N(["TEACHER"])||"PENDING"!==e.status)||!(!N(["ADMIN"])||"PENDING_FINAL"!==e.status),I=e=>"PENDING"===e.status?"TEACHER"===s.value?"审核":"待初审":"PENDING_FINAL"===e.status&&N(["ADMIN"])?"终审":"审核",P=e=>N(["STUDENT"])&&e.submitterId===i.value&&"PENDING"===e.status,D=async e=>{if(r.value.has(e))return console.log("从缓存中获取的用户信息:",r.value.get(e)),r.value.get(e);try{console.log(`开始获取用户${e}信息`);const a=await f.A.get(`/users/basic/${e}`);console.log(`获取用户${e}信息成功:`,a);const t=a?.data||a;return r.value.set(e,t),t}catch(a){return console.error(`获取用户${e}信息失败:`,a),{realName:"未知用户",username:"未知用户"}}},R=async e=>{const a=e.map(async e=>{if(e.submitterId){const a=await D(e.submitterId);e.submitterName=a.realName||a.username||"未知用户"}else e.submitterName="未知用户";return e});return Promise.all(a)},V=async()=>{t.value=!0;try{let e;e=N(["STUDENT"])?await(0,k.uk)(i.value):await(0,k.qN)({...o,page:u.current,pageSize:u.size});let a=e.data?.achievements||e.data||[];a=await R(a),n.value=a,u.total=e.data?.total||n.value.length}catch(e){console.error("加载成果列表失败:",e),h.nk.error("加载成果列表失败: "+(e.response?.data?.message||"未知错误"))}finally{t.value=!1}},L=()=>{u.current=1,V()},W=()=>{Object.assign(o,{title:"",type:"",status:""}),L()},z=()=>{e.push("/dashboard/achievements/create")},S=a=>{e.push(`/dashboard/achievements/${a.id}`)},G=a=>{e.push(`/dashboard/achievements/${a.id}/edit`)},O=e=>{d.value=e,p.approved=!0,p.comment="",c.value=!0},$=async()=>{if(!d.value)return;const e="PENDING"===d.value.status,a="PENDING_FINAL"===d.value.status;if(e&&!N(["TEACHER"])||a&&!N(["ADMIN"]))return void h.nk.warning("您没有权限执行此操作");const t=e?`/achievements/${d.value.id}/first-approve`:`/achievements/${d.value.id}/final-approve`;try{const e=await f.A.post(t,p);h.nk.success(e?.msg||"审核操作成功"),c.value=!1,V()}catch(l){h.nk.error(l.response?.data?.msg||"审核操作失败")}},U=()=>{c.value=!1,d.value=null},x=e=>{b.s.confirm("确定要删除此成果吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,k.dy)(e.id),h.nk.success("删除成功"),V()}catch(a){console.error("删除成果失败:",a),h.nk.error("删除失败: "+(a.response?.data?.message||"未知错误"))}})},X=e=>{u.size=e,V()},K=e=>{u.current=e,V()};return(0,l.sV)(()=>{V()}),{loading:t,achievementList:n,searchForm:o,pagination:u,hasPermission:N,getTypeName:F,getTypeTag:E,getLevelName:A,getLevelTag:y,getStatusName:C,getStatusTag:_,canEdit:w,canApprove:T,canDelete:P,getApprovalButtonText:I,approvalDialogVisible:c,currentAchievement:d,approvalForm:p,handleSearch:L,handleReset:W,handleCreate:z,handleView:S,handleEdit:G,handleApprove:O,submitApproval:$,closeApprovalDialog:U,handleDelete:x,handleSizeChange:X,handleCurrentChange:K}}},F=t(6262);const E=(0,F.A)(N,[["render",p],["__scopeId","data-v-10637df6"]]);var A=E}}]);
//# sourceMappingURL=211.3338beb4.js.map