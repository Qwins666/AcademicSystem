"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[803],{1356:function(e,l,a){a.d(l,{LB:function(){return u},TK:function(){return o},aU:function(){return r},cw:function(){return i},hG:function(){return n},l:function(){return s},pU:function(){return d}});var t=a(86);function r(e){return(0,t.A)({url:"/users",method:"get",params:e})}function o(e,l){return(0,t.A)({url:`/users/${e}`,method:"put",data:l})}function n(e){return(0,t.A)({url:`/users/${e}`,method:"delete"})}function d(e,l){return(0,t.A)({url:`/users/${e}/status`,method:"put",data:{status:l}})}function u(e){return(0,t.A)({url:`/auth/approve-user/${e}`,method:"post"})}function s(e){return(0,t.A)({url:`/auth/reject-user/${e}`,method:"post"})}function i(e){return(0,t.A)({url:`/users/${e}/reset-password`,method:"put"})}},7803:function(e,l,a){a.r(l),a.d(l,{default:function(){return F}});var t=a(641),r=a(33);const o={class:"user-list"},n={class:"search-container"},d={class:"table-container"},u={class:"pagination-container"};function s(e,l,a,s,i,c){const m=(0,t.g2)("el-input"),p=(0,t.g2)("el-form-item"),b=(0,t.g2)("el-option"),h=(0,t.g2)("el-select"),g=(0,t.g2)("Search"),F=(0,t.g2)("el-icon"),k=(0,t.g2)("el-button"),f=(0,t.g2)("Refresh"),w=(0,t.g2)("el-form"),y=(0,t.g2)("el-table-column"),V=(0,t.g2)("el-tag"),_=(0,t.g2)("el-table"),v=(0,t.g2)("el-pagination"),C=(0,t.g2)("el-dialog"),T=(0,t.gN)("loading");return(0,t.uX)(),(0,t.CE)("div",o,[l[28]||(l[28]=(0,t.Lk)("div",{class:"page-header"},[(0,t.Lk)("h1",null,"用户管理")],-1)),(0,t.Lk)("div",n,[(0,t.bF)(w,{model:s.searchForm,inline:""},{default:(0,t.k6)(()=>[(0,t.bF)(p,{label:"用户名"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.searchForm.username,"onUpdate:modelValue":l[0]||(l[0]=e=>s.searchForm.username=e),placeholder:"请输入用户名",style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"真实姓名"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.searchForm.realName,"onUpdate:modelValue":l[1]||(l[1]=e=>s.searchForm.realName=e),placeholder:"请输入真实姓名",style:{width:"150px"},clearable:""},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"角色"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:s.searchForm.role,"onUpdate:modelValue":l[2]||(l[2]=e=>s.searchForm.role=e),placeholder:"请选择角色",clearable:"",style:{width:"120px"}},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"学生",value:"STUDENT"}),(0,t.bF)(b,{label:"教师",value:"TEACHER"}),(0,t.bF)(b,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"状态"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:s.searchForm.status,"onUpdate:modelValue":l[3]||(l[3]=e=>s.searchForm.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"启用",value:"1"}),(0,t.bF)(b,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(p,null,{default:(0,t.k6)(()=>[(0,t.bF)(k,{type:"primary",onClick:s.handleSearch},{default:(0,t.k6)(()=>[(0,t.bF)(F,null,{default:(0,t.k6)(()=>[(0,t.bF)(g)]),_:1}),l[18]||(l[18]=(0,t.eW)(" 搜索 ",-1))]),_:1},8,["onClick"]),(0,t.bF)(k,{onClick:s.handleReset},{default:(0,t.k6)(()=>[(0,t.bF)(F,null,{default:(0,t.k6)(()=>[(0,t.bF)(f)]),_:1}),l[19]||(l[19]=(0,t.eW)(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,t.Lk)("div",d,[(0,t.bo)(((0,t.uX)(),(0,t.Wv)(_,{data:s.userList},{default:(0,t.k6)(()=>[(0,t.bF)(y,{prop:"username",label:"用户名",width:"120"}),(0,t.bF)(y,{prop:"realName",label:"真实姓名",width:"120"}),(0,t.bF)(y,{prop:"gender",label:"性别",width:"100"},{default:(0,t.k6)(e=>[(0,t.eW)((0,r.v_)(s.getGenderName(e.row.gender)),1)]),_:1}),(0,t.bF)(y,{prop:"email",label:"邮箱",width:"200"}),(0,t.bF)(y,{prop:"phone",label:"手机号",width:"130"}),(0,t.bF)(y,{prop:"studentId",label:"学号/工号",width:"120"}),(0,t.bF)(y,{prop:"department",label:"院系",width:"150"}),(0,t.bF)(y,{prop:"major",label:"专业",width:"150"}),(0,t.bF)(y,{prop:"grade",label:"年级",width:"100"}),(0,t.bF)(y,{prop:"roles",label:"角色",width:"100"},{default:(0,t.k6)(e=>[(0,t.bF)(V,{type:s.getRoleTag(e.row.roles?e.row.roles[0]:"")},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(s.getRoleName(e.row.roles?e.row.roles[0]:"")),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(y,{prop:"status",label:"状态",width:"100"},{default:(0,t.k6)(e=>[(0,t.bF)(V,{type:1===e.row.status?"success":"danger"},{default:(0,t.k6)(()=>[(0,t.eW)((0,r.v_)(1===e.row.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),(0,t.bF)(y,{label:"操作",width:"280",fixed:"right"},{default:(0,t.k6)(e=>[(0,t.bF)(k,{type:"warning",size:"small",onClick:l=>s.handleEdit(e.row)},{default:(0,t.k6)(()=>[...l[20]||(l[20]=[(0,t.eW)(" 编辑 ",-1)])]),_:1},8,["onClick"]),0===e.row.status?((0,t.uX)(),(0,t.CE)(t.FK,{key:0},[(0,t.bF)(k,{type:"success",size:"small",onClick:l=>s.handleApprove(e.row)},{default:(0,t.k6)(()=>[...l[21]||(l[21]=[(0,t.eW)(" 审批通过 ",-1)])]),_:1},8,["onClick"]),(0,t.bF)(k,{type:"danger",size:"small",onClick:l=>s.handleReject(e.row)},{default:(0,t.k6)(()=>[...l[22]||(l[22]=[(0,t.eW)(" 拒绝 ",-1)])]),_:1},8,["onClick"])],64)):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(k,{type:"danger",size:"small",onClick:l=>s.handleToggleStatus(e.row)},{default:(0,t.k6)(()=>[...l[23]||(l[23]=[(0,t.eW)(" 禁用 ",-1)])]),_:1},8,["onClick"]),(0,t.bF)(k,{type:"primary",size:"small",onClick:l=>s.handleResetPassword(e.row)},{default:(0,t.k6)(()=>[...l[24]||(l[24]=[(0,t.eW)(" 重置密码 ",-1)])]),_:1},8,["onClick"]),"ADMIN"!==e.row.role?((0,t.uX)(),(0,t.Wv)(k,{key:0,type:"danger",size:"small",onClick:l=>s.handleDelete(e.row)},{default:(0,t.k6)(()=>[...l[25]||(l[25]=[(0,t.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,t.Q3)("",!0)],64))]),_:1})]),_:1},8,["data"])),[[T,s.loading]]),(0,t.Lk)("div",u,[(0,t.bF)(v,{"current-page":s.pagination.current,"onUpdate:currentPage":l[4]||(l[4]=e=>s.pagination.current=e),"page-size":s.pagination.size,"onUpdate:pageSize":l[5]||(l[5]=e=>s.pagination.size=e),total:s.pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:s.handleSizeChange,onCurrentChange:s.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),(0,t.bF)(C,{modelValue:s.editDialogVisible,"onUpdate:modelValue":l[17]||(l[17]=e=>s.editDialogVisible=e),title:"编辑用户",width:"600px"},{footer:(0,t.k6)(()=>[(0,t.bF)(k,{onClick:l[16]||(l[16]=e=>s.editDialogVisible=!1)},{default:(0,t.k6)(()=>[...l[26]||(l[26]=[(0,t.eW)("取消",-1)])]),_:1}),(0,t.bF)(k,{type:"primary",onClick:s.handleSaveEdit},{default:(0,t.k6)(()=>[...l[27]||(l[27]=[(0,t.eW)("确定",-1)])]),_:1},8,["onClick"])]),default:(0,t.k6)(()=>[(0,t.bF)(w,{ref:"editFormRef",model:s.editForm,rules:s.editFormRules,"label-width":"100px"},{default:(0,t.k6)(()=>[(0,t.bF)(p,{label:"用户名",prop:"username"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.username,"onUpdate:modelValue":l[6]||(l[6]=e=>s.editForm.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"真实姓名",prop:"realName"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.realName,"onUpdate:modelValue":l[7]||(l[7]=e=>s.editForm.realName=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"邮箱",prop:"email"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.email,"onUpdate:modelValue":l[8]||(l[8]=e=>s.editForm.email=e),placeholder:"请输入邮箱",type:"email"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"手机号",prop:"phone"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.phone,"onUpdate:modelValue":l[9]||(l[9]=e=>s.editForm.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"学号/工号"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.studentId,"onUpdate:modelValue":l[10]||(l[10]=e=>s.editForm.studentId=e),placeholder:"请输入学号/工号"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"院系"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.department,"onUpdate:modelValue":l[11]||(l[11]=e=>s.editForm.department=e),placeholder:"请输入院系"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"专业"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.major,"onUpdate:modelValue":l[12]||(l[12]=e=>s.editForm.major=e),placeholder:"请输入专业"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"年级"},{default:(0,t.k6)(()=>[(0,t.bF)(m,{modelValue:s.editForm.grade,"onUpdate:modelValue":l[13]||(l[13]=e=>s.editForm.grade=e),placeholder:"请输入年级"},null,8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"性别"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:s.editForm.gender,"onUpdate:modelValue":l[14]||(l[14]=e=>s.editForm.gender=e),placeholder:"请选择性别"},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"未知",value:"0"}),(0,t.bF)(b,{label:"男",value:"1"}),(0,t.bF)(b,{label:"女",value:"2"})]),_:1},8,["modelValue"])]),_:1}),(0,t.bF)(p,{label:"用户角色"},{default:(0,t.k6)(()=>[(0,t.bF)(h,{modelValue:s.editForm.roles,"onUpdate:modelValue":l[15]||(l[15]=e=>s.editForm.roles=e),placeholder:"请选择用户角色",style:{width:"200px"}},{default:(0,t.k6)(()=>[(0,t.bF)(b,{label:"学生",value:"STUDENT"}),(0,t.bF)(b,{label:"教师",value:"TEACHER"}),(0,t.bF)(b,{label:"管理员",value:"ADMIN"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}var i=a(953),c=a(163),m=a(7918),p=a(1356),b={name:"UserList",setup(){const e=(0,i.KR)(!1),l=(0,i.KR)([]),a=(0,i.Kh)({username:"",realName:"",role:"",status:""}),r=(0,i.Kh)({current:1,size:10,total:0}),o=e=>{const l={STUDENT:"学生",TEACHER:"教师",ADMIN:"管理员"};return l[e]||e||""},n=e=>{const l={STUDENT:"success",TEACHER:"warning",ADMIN:"danger"};return l[e]||"info"},d=async()=>{e.value=!0;try{const e={page:r.current,size:r.size,username:a.username,realName:a.realName,role:a.role,status:a.status},t=await(0,p.aU)(e);200===t.code?(l.value=t.data.records||t.data,r.total=t.data.total||l.value.length):(c.nk.error(t.message||"加载用户列表失败"),l.value=[],r.total=0)}catch(t){c.nk.error("加载用户列表失败"),console.error("加载用户列表错误:",t),l.value=[],r.total=0}finally{e.value=!1}},u=()=>{r.current=1,d()},s=()=>{Object.assign(a,{username:"",realName:"",role:"",status:""}),u()},b=(0,i.KR)(!1),h=(0,i.KR)(null),g=(0,i.KR)({}),F=e=>{const l={0:"未知",1:"男",2:"女"};return l[e]||"未知"},k={username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],realName:[{required:!0,message:"真实姓名不能为空",trigger:"blur"}],email:[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}]},f=e=>{g.value={...e},b.value=!0},w=async()=>{try{const e={...g.value};e.roles&&"string"===typeof e.roles&&(e.roles=[e.roles]);const l=await(0,p.TK)(g.value.id,e);200===l.code?(c.nk.success("用户信息更新成功"),b.value=!1,d()):c.nk.error(l.message||"用户信息更新失败")}catch(e){c.nk.error("用户信息更新失败"),console.error("更新用户信息错误:",e)}},y=async e=>{m.s.confirm("确定要审批通过此用户吗？","确认审批",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await(0,p.LB)(e.id);200===l.code?(c.nk.success("用户审批通过"),d()):c.nk.error(l.message||"审批失败")}catch(l){c.nk.error("审批失败，请稍后重试"),console.error("审批用户错误:",l)}})},V=async e=>{m.s.confirm("确定要拒绝此用户申请吗？","确认拒绝",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await(0,p.l)(e.id);200===l.code?(c.nk.success("已拒绝用户申请"),d()):c.nk.error(l.message||"拒绝失败")}catch(l){c.nk.error("拒绝失败，请稍后重试"),console.error("拒绝用户错误:",l)}})},_=async e=>{const l=1===e.status?"禁用":"启用",a=1===e.status?0:1;m.s.confirm(`确定要${l}此用户吗？`,`确认${l}`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await(0,p.pU)(e.id,a);200===t.code?(c.nk.success(`${l}成功`),d()):c.nk.error(t.message||`${l}失败`)}catch(t){c.nk.error(`${l}失败，请稍后重试`),console.error("更新用户状态错误:",t)}})},v=async e=>{m.s.confirm("确定要重置此用户的密码吗？重置后密码将恢复为初始密码。","确认重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await(0,p.cw)(e.id);200===l.code?c.nk.success("密码重置成功"):c.nk.error(l.message||"密码重置失败")}catch(l){c.nk.error("密码重置失败，请稍后重试"),console.error("重置用户密码错误:",l)}})},C=async e=>{m.s.confirm("确定要删除此用户吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const l=await(0,p.hG)(e.id);200===l.code?(c.nk.success("删除成功"),d()):c.nk.error(l.message||"删除失败")}catch(l){c.nk.error("删除失败，请稍后重试"),console.error("删除用户错误:",l)}})},T=e=>{r.size=e,d()},U=e=>{r.current=e,d()};return(0,t.sV)(()=>{d()}),{loading:e,userList:l,searchForm:a,pagination:r,getRoleName:o,getRoleTag:n,getGenderName:F,handleSearch:u,handleReset:s,handleEdit:f,handleSaveEdit:w,handleToggleStatus:_,handleDelete:C,handleApprove:y,handleReject:V,handleResetPassword:v,handleSizeChange:T,handleCurrentChange:U,editDialogVisible:b,editForm:g,editFormRef:h,editFormRules:k}}},h=a(6262);const g=(0,h.A)(b,[["render",s],["__scopeId","data-v-5608c00e"]]);var F=g}}]);
//# sourceMappingURL=803.f9d0dc74.js.map