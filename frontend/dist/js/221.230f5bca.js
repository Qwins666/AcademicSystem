"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[221],{3221:function(t,e,a){a.r(e),a.d(e,{default:function(){return z}});var i=a(641),n=a(33);const r={class:"certificate-view"},c={class:"page-header"},s={key:0,class:"certificate-container"},u={class:"certificate-card"},o={class:"certificate-content"},l={class:"student-name"},v={class:"message"},d={class:"activity-title"},f={class:"activity-type"},m={class:"certificate-footer"},y={class:"signature-area"},g={class:"signature-date"},p={class:"action-buttons"},k={key:1,class:"loading-container"};function D(t,e,a,D,h,T){const L=(0,i.g2)("el-button"),w=(0,i.g2)("el-skeleton");return(0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("div",c,[e[1]||(e[1]=(0,i.Lk)("h2",null,"电子参赛证明",-1)),(0,i.bF)(L,{type:"primary",onClick:D.handleBack},{default:(0,i.k6)(()=>[...e[0]||(e[0]=[(0,i.eW)("返回活动详情",-1)])]),_:1},8,["onClick"])]),D.loading?((0,i.uX)(),(0,i.CE)("div",k,[(0,i.bF)(w,{rows:10,animated:""})])):((0,i.uX)(),(0,i.CE)("div",s,[(0,i.Lk)("div",u,[e[4]||(e[4]=(0,i.Lk)("div",{class:"certificate-header"},[(0,i.Lk)("h1",null,"电子参赛证明"),(0,i.Lk)("p",{class:"subtitle"},"Certificate of Participation")],-1)),(0,i.Lk)("div",o,[e[2]||(e[2]=(0,i.Lk)("p",{class:"present-to"},"兹证明",-1)),(0,i.Lk)("p",l,(0,n.v_)(D.certificateData.studentName),1),(0,i.Lk)("p",v,"同学于 "+(0,n.v_)(D.formatDate(D.certificateData.activityDate))+" 参加了",1),(0,i.Lk)("p",d,(0,n.v_)(D.certificateData.activityTitle),1),(0,i.Lk)("p",f,(0,n.v_)(D.certificateData.activityType),1),e[3]||(e[3]=(0,i.Lk)("p",{class:"footer-message"},"特发此证，以资鼓励",-1))]),(0,i.Lk)("div",m,[(0,i.Lk)("div",y,[(0,i.Lk)("p",null,"主办方："+(0,n.v_)(D.certificateData.organizer),1),(0,i.Lk)("p",g,"日期："+(0,n.v_)(D.formatDate(D.certificateData.issueDate)),1)])])]),(0,i.Lk)("div",p,[(0,i.bF)(L,{onClick:D.handlePrint},{default:(0,i.k6)(()=>[...e[5]||(e[5]=[(0,i.eW)("打印证书",-1)])]),_:1},8,["onClick"])])]))])}var h=a(953),T=a(5220),L=a(6278),w=a(163),I=a(4930),C={name:"CertificateView",setup(){const t=(0,T.rd)(),e=(0,T.lq)(),a=(0,L.Pj)(),n=(0,h.KR)(!0),r=(0,h.KR)({}),c=(0,h.KR)({studentName:"",activityTitle:"",activityType:"",activityDate:"",organizer:"",issueDate:(new Date).toISOString(),certificateUrl:""}),s=(0,i.EW)(()=>a.getters.user||{}),u=((0,i.EW)(()=>a.getters.userRole),(0,i.EW)(()=>a.getters.userId),t=>{if(!t)return"-";const e=new Date(t);return isNaN(e.getTime())?t:e.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}),o=t=>{const e={LECTURE:"讲座",COMPETITION:"赛事",TRAINING:"培训"};return e[t]||t},l=async t=>{try{const e=await(0,I.qP)(t);return 200===e.code&&(r.value=e.data||{},!0)}catch(e){return console.error("加载活动详情失败:",e),!1}},v=async()=>{n.value=!0;try{const t=e.params.activityId;console.log("加载证书数据 - 活动ID:",t),await l(t);const i=await(0,I.BQ)(t);console.log("store的数据：",a.getters.user);const n=s.value?.realName||s.value?.username||s.value?.nickname||"学生姓名";200===i.code||i.success?(c.value={...c.value,certificateUrl:i.data||"",studentName:i.studentName||i.data?.studentName||n,activityTitle:i.activityTitle||i.data?.activityTitle||r.value.title||"活动名称",activityType:i.activityType||i.data?.activityType||o(r.value.type),activityDate:i.activityDate||i.data?.activityDate||r.value.startTime||(new Date).toISOString(),organizer:i.organizer||i.data?.organizer||r.value.organizer||"主办方",issueDate:i.issueDate||i.data?.issueDate||(new Date).toISOString()},console.log("证书数据:",c.value)):(c.value={...c.value,studentName:n,activityTitle:r.value.title||"活动名称",activityType:o(r.value.type),activityDate:r.value.startTime||(new Date).toISOString(),organizer:r.value.organizer||"主办方"},console.log("使用本地数据填充证书:",c.value))}catch(t){console.error("加载证书失败:",t);const e=t.response?.data?.message||t.message||"加载证书失败，请稍后重试";w.nk.error(e);const a=s.value?.name||s.value?.username||s.value?.nickname||"学生姓名";c.value={...c.value,studentName:a,activityTitle:r.value.title||"活动名称",activityType:o(r.value.type),activityDate:r.value.startTime||(new Date).toISOString(),organizer:r.value.organizer||"主办方"}}finally{n.value=!1}},d=()=>{const a=e.params.activityId;t.push(`/dashboard/activities/${a}`)},f=()=>{window.print()};return(0,i.sV)(()=>{v()}),{loading:n,certificateData:c,formatDate:u,handleBack:d,handlePrint:f}}},N=a(6262);const _=(0,N.A)(C,[["render",D],["__scopeId","data-v-641498cd"]]);var z=_},4930:function(t,e,a){a.d(e,{$y:function(){return u},BQ:function(){return v},E1:function(){return c},ES:function(){return n},IE:function(){return l},J0:function(){return s},Kg:function(){return o},qP:function(){return r},zW:function(){return d}});var i=a(86);function n(t={}){return(0,i.A)({url:"/activities",method:"get",params:t})}function r(t){return(0,i.A)({url:`/activities/${t}`,method:"get"})}function c(t){return(0,i.A)({url:"/activities",method:"post",data:t})}function s(t,e){return(0,i.A)({url:`/activities/${t}`,method:"put",data:e})}function u(t){return(0,i.A)({url:`/activities/${t}`,method:"delete"})}function o(t){return(0,i.A)({url:`/activities/${t}/register`,method:"post",data:{}})}function l(t){return(0,i.A)({url:`/activities/${t}/cancel-register`,method:"post"})}function v(t){return(0,i.A)({url:`/activities/${t}/certificate`,method:"get"})}function d(t,e="excel"){return(0,i.A)({url:`/activities/${t}/participants/export`,method:"get",params:{type:e},responseType:"blob"})}}}]);
//# sourceMappingURL=221.230f5bca.js.map