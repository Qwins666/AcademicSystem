{"version":3,"file":"js/84.39f79051.js","mappings":"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","sources":["webpack://academic-management-frontend/./src/api/achievement.js","webpack://academic-management-frontend/./src/views/achievement/AchievementForm.vue","webpack://academic-management-frontend/./src/views/achievement/AchievementForm.vue?80d8"],"sourcesContent":["import request from './request'\n\n// 获取成果列表\nexport function getAchievementList(params = {}) {\n  return request({\n    url: '/achievements',\n    method: 'get',\n    params\n  })\n}\n\n// 获取成果详情\nexport function getAchievementById(id) {\n  return request({\n    url: `/achievements/${id}`,\n    method: 'get'\n  })\n}\n\n// 创建成果\nexport function createAchievement(data) {\n  return request({\n    url: '/achievements',\n    method: 'post',\n    data\n  })\n}\n\n// 更新成果\nexport function updateAchievement(id, data) {\n  return request({\n    url: `/achievements/${id}`,\n    method: 'put',\n    data\n  })\n}\n\n// 删除成果\nexport function deleteAchievement(id) {\n  return request({\n    url: `/achievements/${id}`,\n    method: 'delete'\n  })\n}\n\n// 根据类型获取成果\nexport function getAchievementsByType(type) {\n  return request({\n    url: `/achievements/type/${type}`,\n    method: 'get'\n  })\n}\n\n// 根据级别获取成果\nexport function getAchievementsByLevel(level) {\n  return request({\n    url: `/achievements/level/${level}`,\n    method: 'get'\n  })\n}\n\n// 获取用户的成果列表\nexport function getUserAchievements(userId) {\n  return request({\n    url: `/achievements/submitter/${userId}`,\n    method: 'get'\n  })\n}\n\n// 上传成果文件\nexport function uploadAchievementFile(formData) {\n  return request({\n    url: '/achievements/upload-file',\n    method: 'post',\n    data: formData,\n    headers: {\n      'Content-Type': 'multipart/form-data'\n    }\n  })\n}","<template>\r\n  <div class=\"achievement-form\">\r\n    <div class=\"page-header\">\r\n      <h1>{{ isEdit ? '编辑成果' : '申报成果' }}</h1>\r\n      <el-button @click=\"handleBack\">\r\n        <el-icon><ArrowLeft /></el-icon>\r\n        返回\r\n      </el-button>\r\n    </div>\r\n\r\n    <div class=\"form-container\">\r\n      <el-form\r\n        ref=\"formRef\"\r\n        :model=\"form\"\r\n        :rules=\"rules\"\r\n        label-width=\"120px\"\r\n        @submit.prevent=\"handleSubmit\"\r\n      >\r\n        <el-form-item label=\"成果标题\" prop=\"title\">\r\n          <el-input\r\n            v-model=\"form.title\"\r\n            placeholder=\"请输入成果标题\"\r\n            maxlength=\"200\"\r\n            show-word-limit\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"成果类型\" prop=\"type\">\r\n          <el-select v-model=\"form.type\" placeholder=\"请选择成果类型\" style=\"width: 100%\">\r\n            <el-option label=\"论文\" value=\"PAPER\" />\r\n            <el-option label=\"专利\" value=\"PATENT\" />\r\n            <el-option label=\"证书\" value=\"CERTIFICATE\" />\r\n            <el-option label=\"项目\" value=\"PROJECT\" />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"成果描述\" prop=\"description\">\r\n          <el-input\r\n            v-model=\"form.description\"\r\n            type=\"textarea\"\r\n            :rows=\"4\"\r\n            placeholder=\"请输入成果描述\"\r\n            maxlength=\"1000\"\r\n            show-word-limit\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"成果级别\" prop=\"level\">\r\n          <el-select v-model=\"form.level\" placeholder=\"请选择成果级别\" style=\"width: 100%\">\r\n            <el-option label=\"国家级\" value=\"NATIONAL\" />\r\n            <el-option label=\"省级\" value=\"PROVINCIAL\" />\r\n            <el-option label=\"校级\" value=\"SCHOOL\" />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"标签\">\r\n          <el-input\r\n            v-model=\"form.tags\"\r\n            placeholder=\"请输入标签，多个标签用逗号分隔\"\r\n            maxlength=\"500\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"成果文件\" prop=\"file\">\r\n          <el-upload\r\n            ref=\"uploadRef\"\r\n            :auto-upload=\"false\"\r\n            :on-change=\"handleFileChange\"\r\n            :before-upload=\"beforeUpload\"\r\n            :file-list=\"fileList\"\r\n            accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png\"\r\n            drag\r\n          >\r\n            <el-icon class=\"el-icon--upload\"><upload-filled /></el-icon>\r\n            <div class=\"el-upload__text\">\r\n              将文件拖到此处，或<em>点击上传</em>\r\n            </div>\r\n            <template #tip>\r\n              <div class=\"el-upload__tip\">\r\n                支持 PDF、Word、图片格式，文件大小不超过10MB\r\n              </div>\r\n            </template>\r\n          </el-upload>\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" :loading=\"loading\" @click=\"handleSubmit\">\r\n            {{ isEdit ? '更新' : '提交' }}\r\n          </el-button>\r\n          <el-button @click=\"handleReset\">重置</el-button>\r\n          <el-button @click=\"handleBack\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { createAchievement, updateAchievement, getAchievementById } from '@/api/achievement'\r\n\r\nexport default {\r\n  name: 'AchievementForm',\r\n  setup() {\r\n    const router = useRouter()\r\n    const route = useRoute()\r\n    \r\n    const formRef = ref()\r\n    const uploadRef = ref()\r\n    const loading = ref(false)\r\n    const fileList = ref([])\r\n    \r\n    const isEdit = computed(() => !!route.params.id)\r\n    \r\n    const form = reactive({\r\n      title: '',\r\n      type: '',\r\n      description: '',\r\n      level: '',\r\n      tags: '',\r\n      file: null\r\n    })\r\n    \r\n    const rules = {\r\n      title: [\r\n        { required: true, message: '请输入成果标题', trigger: 'blur' },\r\n        { min: 2, max: 200, message: '标题长度在2到200个字符', trigger: 'blur' }\r\n      ],\r\n      type: [\r\n        { required: true, message: '请选择成果类型', trigger: 'change' }\r\n      ],\r\n      description: [\r\n        { required: true, message: '请输入成果描述', trigger: 'blur' },\r\n        { min: 10, max: 1000, message: '描述长度在10到1000个字符', trigger: 'blur' }\r\n      ],\r\n      level: [\r\n        { required: true, message: '请选择成果级别', trigger: 'change' }\r\n      ]\r\n    }\r\n    \r\n    const loadAchievementData = async () => {\r\n      if (isEdit.value) {\r\n        try {\r\n          const achievementId = route.params.id\r\n          const response = await getAchievementById(achievementId)\r\n          if (response.data) {\r\n            const achievement = response.data\r\n            Object.assign(form, {\r\n              title: achievement.title || '',\r\n              type: achievement.type || '',\r\n              description: achievement.description || '',\r\n              level: achievement.level || '',\r\n              tags: achievement.tags || ''\r\n            })\r\n          }\r\n        } catch (error) {\r\n          console.error('加载成果数据失败:', error)\r\n          ElMessage.error('加载成果数据失败')\r\n        }\r\n      }\r\n    }\r\n    \r\n    const handleFileChange = (file, fileList) => {\r\n      form.file = file.raw\r\n    }\r\n    \r\n    const beforeUpload = (file) => {\r\n      const isValidType = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png'].includes(file.type)\r\n      const isLt10M = file.size / 1024 / 1024 < 10\r\n\r\n      if (!isValidType) {\r\n        ElMessage.error('只能上传 PDF、Word、图片格式的文件!')\r\n        return false\r\n      }\r\n      if (!isLt10M) {\r\n        ElMessage.error('文件大小不能超过 10MB!')\r\n        return false\r\n      }\r\n      return false // 阻止自动上传\r\n    }\r\n    \r\n    const handleSubmit = async () => {\r\n      if (!formRef.value) return\r\n      \r\n      await formRef.value.validate(async (valid) => {\r\n        if (valid) {\r\n          if (!form.file && !isEdit.value) {\r\n            ElMessage.warning('请上传成果文件')\r\n            return\r\n          }\r\n          \r\n          loading.value = true\r\n          try {\r\n            // 准备提交数据\r\n            const submitData = {\r\n              title: form.title,\r\n              type: form.type,\r\n              description: form.description,\r\n              level: form.level,\r\n              tags: form.tags || ''\r\n              // 文件暂时不处理，需要单独上传或者后端支持multipart/form-data后再添加\r\n            }\r\n            \r\n            let result\r\n            if (isEdit.value) {\r\n              // 更新成果\r\n              result = await updateAchievement(route.params.id, submitData)\r\n              ElMessage.success('成果更新成功')\r\n            } else {\r\n              // 创建新成果\r\n              result = await createAchievement(submitData)\r\n              ElMessage.success('成果提交成功')\r\n              \r\n              // 如果有文件且是新创建，上传文件\r\n              if (form.file && result.data && result.data.id) {\r\n                try {\r\n                  const formData = new FormData()\r\n                  formData.append('file', form.file)\r\n                  formData.append('achievementId', result.data.id)\r\n                  \r\n                  // 这里可以调用专门的文件上传接口\r\n                  // await uploadAchievementFile(formData)\r\n                  // ElMessage.success('文件上传成功')\r\n                } catch (uploadError) {\r\n                  console.error('文件上传失败:', uploadError)\r\n                  ElMessage.warning('成果提交成功，但文件上传失败，请稍后手动上传')\r\n                }\r\n              }\r\n            }\r\n            \r\n            router.push('/dashboard/achievements')\r\n          } catch (error) {\r\n            console.error('操作失败:', error)\r\n            // 显示详细的错误信息\r\n            const errorMsg = error.response?.data?.message || error.message || (isEdit.value ? '更新成果失败' : '提交成果失败')\r\n            ElMessage.error(errorMsg)\r\n          } finally {\r\n            loading.value = false\r\n          }\r\n        }\r\n      })\r\n    }\r\n    \r\n    const handleReset = () => {\r\n      if (formRef.value) {\r\n        formRef.value.resetFields()\r\n      }\r\n      fileList.value = []\r\n      form.file = null\r\n    }\r\n    \r\n    const handleBack = () => {\r\n      router.push('/dashboard/achievements')\r\n    }\r\n    \r\n    onMounted(() => {\r\n      loadAchievementData()\r\n    })\r\n    \r\n    return {\r\n      formRef,\r\n      uploadRef,\r\n      loading,\r\n      fileList,\r\n      isEdit,\r\n      form,\r\n      rules,\r\n      handleFileChange,\r\n      beforeUpload,\r\n      handleSubmit,\r\n      handleReset,\r\n      handleBack\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.achievement-form {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.page-header h1 {\r\n  margin: 0;\r\n  color: #2c3e50;\r\n}\r\n\r\n.form-container {\r\n  background: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n  padding: 30px;\r\n}\r\n</style>\r\n","import { render } from \"./AchievementForm.vue?vue&type=template&id=e819a1ae&scoped=true\"\nimport script from \"./AchievementForm.vue?vue&type=script&lang=js\"\nexport * from \"./AchievementForm.vue?vue&type=script&lang=js\"\n\nimport \"./AchievementForm.vue?vue&type=style&index=0&id=e819a1ae&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-e819a1ae\"]])\n\nexport default __exports__"],"names":["getAchievementList","params","url","method","getAchievementById","id","createAchievement","data","updateAchievement","deleteAchievement","getUserAchievements","userId","class","isEdit","handleBack","ref","model","form","rules","handleSubmit","label","prop","title","placeholder","maxlength","type","style","value","description","rows","level","tags","handleFileChange","beforeUpload","fileList","accept","drag","tip","loading","handleReset","name","setup","router","route","formRef","uploadRef","file","required","message","trigger","min","max","loadAchievementData","async","achievementId","response","achievement","Object","assign","error","console","raw","isValidType","includes","isLt10M","size","validate","valid","warning","submitData","result","success","formData","FormData","append","uploadError","push","errorMsg","resetFields","__exports__","render"],"sourceRoot":""}