{"version":3,"file":"js/221.230f5bca.js","mappings":"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","sources":["webpack://academic-management-frontend/./src/views/activity/CertificateView.vue","webpack://academic-management-frontend/./src/views/activity/CertificateView.vue?0c12","webpack://academic-management-frontend/./src/api/activity.js"],"sourcesContent":["<template>\n  <div class=\"certificate-view\">\n    <div class=\"page-header\">\n      <h2>电子参赛证明</h2>\n      <el-button type=\"primary\" @click=\"handleBack\">返回活动详情</el-button>\n    </div>\n    \n    <div class=\"certificate-container\" v-if=\"!loading\">\n      <div class=\"certificate-card\">\n        <div class=\"certificate-header\">\n          <h1>电子参赛证明</h1>\n          <p class=\"subtitle\">Certificate of Participation</p>\n        </div>\n        \n        <div class=\"certificate-content\">\n          <p class=\"present-to\">兹证明</p>\n          <p class=\"student-name\">{{ certificateData.studentName }}</p>\n          <p class=\"message\">同学于 {{ formatDate(certificateData.activityDate) }} 参加了</p>\n          <p class=\"activity-title\">{{ certificateData.activityTitle }}</p>\n          <p class=\"activity-type\">{{ certificateData.activityType }}</p>\n          <p class=\"footer-message\">特发此证，以资鼓励</p>\n        </div>\n        \n        <div class=\"certificate-footer\">\n          <div class=\"signature-area\">\n            <p>主办方：{{ certificateData.organizer }}</p>\n            <p class=\"signature-date\">日期：{{ formatDate(certificateData.issueDate) }}</p>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"action-buttons\">\n        <el-button @click=\"handlePrint\">打印证书</el-button>\n      </div>\n    </div>\n    \n    <div v-else class=\"loading-container\">\n      <el-skeleton :rows=\"10\" animated />\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted, computed } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { ElMessage } from 'element-plus'\nimport { generateCertificate, getActivityById } from '@/api/activity'\n\nexport default {\n  name: 'CertificateView',\n  setup() {\n    const router = useRouter()\n    const route = useRoute()\n    const store = useStore()\n    \n    const loading = ref(true)\n    const activityDetail = ref({})\n    const certificateData = ref({\n      studentName: '',\n      activityTitle: '',\n      activityType: '',\n      activityDate: '',\n      organizer: '',\n      issueDate: new Date().toISOString(),\n      certificateUrl: ''\n    })\n    \n    const user = computed(() => store.getters.user || {})\n    const userRole = computed(() => store.getters.userRole)\n    const userId = computed(() => store.getters.userId)\n    \n    const formatDate = (dateTime) => {\n      if (!dateTime) return '-'  \n      const date = new Date(dateTime)\n      if (isNaN(date.getTime())) return dateTime\n      return date.toLocaleDateString('zh-CN', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      })\n    }\n    \n    const getActivityTypeName = (type) => {\n      const typeMap = {\n        'LECTURE': '讲座',\n        'COMPETITION': '赛事',\n        'TRAINING': '培训'\n      }\n      return typeMap[type] || type\n    }\n    \n    const loadActivityDetail = async (activityId) => {\n      try {\n        const response = await getActivityById(activityId)\n        if (response.code === 200) {\n          activityDetail.value = response.data || {}\n          return true\n        }\n        return false\n      } catch (error) {\n        console.error('加载活动详情失败:', error)\n        return false\n      }\n    }\n    \n    const loadCertificateData = async () => {\n      loading.value = true\n      try {\n        const activityId = route.params.activityId\n        console.log('加载证书数据 - 活动ID:', activityId)\n        \n        // 先加载活动详情，获取真实的活动信息\n        await loadActivityDetail(activityId)\n        \n        // 调用生成证明接口\n        const response = await generateCertificate(activityId)\n        console.log('store的数据：', store.getters.user)\n        // 获取真实的学生姓名（从store的user对象中）\n        const realStudentName = user.value?.realName || user.value?.username || user.value?.nickname || '学生姓名'\n        \n        if (response.code === 200 || response.success) {\n          // 更新证书数据，优先使用响应中的数据，其次使用活动详情数据，最后使用默认值\n          certificateData.value = {\n            ...certificateData.value,\n            certificateUrl: response.data || '',\n            studentName: response.studentName || response.data?.studentName || realStudentName,\n            activityTitle: response.activityTitle || response.data?.activityTitle || activityDetail.value.title || '活动名称',\n            activityType: response.activityType || response.data?.activityType || getActivityTypeName(activityDetail.value.type),\n            activityDate: response.activityDate || response.data?.activityDate || activityDetail.value.startTime || new Date().toISOString(),\n            organizer: response.organizer || response.data?.organizer || activityDetail.value.organizer || '主办方',\n            issueDate: response.issueDate || response.data?.issueDate || new Date().toISOString()\n          }\n          console.log('证书数据:', certificateData.value)\n        } else {\n          // 即使接口返回失败，也使用活动详情和用户信息填充证书\n          certificateData.value = {\n            ...certificateData.value,\n            studentName: realStudentName,\n            activityTitle: activityDetail.value.title || '活动名称',\n            activityType: getActivityTypeName(activityDetail.value.type),\n            activityDate: activityDetail.value.startTime || new Date().toISOString(),\n            organizer: activityDetail.value.organizer || '主办方'\n          }\n          console.log('使用本地数据填充证书:', certificateData.value)\n        }\n      } catch (error) {\n        console.error('加载证书失败:', error)\n        const errorMsg = error.response?.data?.message || error.message || '加载证书失败，请稍后重试'\n        ElMessage.error(errorMsg)\n        \n        // 错误情况下也尝试使用本地数据\n        const realStudentName = user.value?.name || user.value?.username || user.value?.nickname || '学生姓名'\n        certificateData.value = {\n          ...certificateData.value,\n          studentName: realStudentName,\n          activityTitle: activityDetail.value.title || '活动名称',\n          activityType: getActivityTypeName(activityDetail.value.type),\n          activityDate: activityDetail.value.startTime || new Date().toISOString(),\n          organizer: activityDetail.value.organizer || '主办方'\n        }\n      } finally {\n        loading.value = false\n      }\n    }\n    \n    const handleBack = () => {\n      const activityId = route.params.activityId\n      router.push(`/dashboard/activities/${activityId}`)\n    }\n    \n    const handlePrint = () => {\n      window.print()\n    }\n    \n    onMounted(() => {\n      loadCertificateData()\n    })\n    \n    return {\n      loading,\n      certificateData,\n      formatDate,\n      handleBack,\n      handlePrint\n    }\n  }\n}\n</script>\n\n<style scoped>\n.certificate-view {\n  padding: 20px;\n  max-width: 1200px;\n  margin: 0 auto;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.certificate-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.certificate-card {\n  width: 80%;\n  max-width: 800px;\n  background: white;\n  border: 2px solid #dcdfe6;\n  border-radius: 8px;\n  padding: 40px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  margin-bottom: 30px;\n}\n\n.certificate-header {\n  text-align: center;\n  margin-bottom: 40px;\n  padding-bottom: 20px;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.certificate-header h1 {\n  font-size: 2.5rem;\n  color: #303133;\n  margin: 0 0 10px 0;\n  font-weight: bold;\n}\n\n.certificate-header .subtitle {\n  font-size: 1.2rem;\n  color: #606266;\n  margin: 0;\n  font-style: italic;\n}\n\n.certificate-content {\n  text-align: center;\n  margin-bottom: 40px;\n}\n\n.certificate-content p {\n  margin: 20px 0;\n  line-height: 1.8;\n}\n\n.present-to {\n  font-size: 1.3rem;\n  color: #303133;\n}\n\n.student-name {\n  font-size: 2rem;\n  font-weight: bold;\n  color: #303133;\n  margin: 30px 0;\n}\n\n.message {\n  font-size: 1.3rem;\n  color: #303133;\n}\n\n.activity-title {\n  font-size: 1.8rem;\n  font-weight: bold;\n  color: #303133;\n  margin: 30px 0;\n}\n\n.activity-type {\n  font-size: 1.3rem;\n  color: #303133;\n}\n\n.footer-message {\n  font-size: 1.3rem;\n  color: #303133;\n  margin-top: 40px;\n}\n\n.certificate-footer {\n  text-align: right;\n  padding-top: 20px;\n  border-top: 1px solid #e0e0e0;\n}\n\n.signature-area p {\n  margin: 10px 0;\n  font-size: 1.1rem;\n  color: #606266;\n}\n\n.signature-date {\n  font-style: italic;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 20px;\n}\n\n.loading-container {\n  margin-top: 40px;\n  width: 80%;\n  max-width: 800px;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n/* 打印样式优化 */\n@media print {\n  .page-header,\n  .action-buttons {\n    display: none;\n  }\n  \n  .certificate-card {\n    box-shadow: none;\n    width: 100%;\n    max-width: none;\n  }\n}\n</style>","import { render } from \"./CertificateView.vue?vue&type=template&id=641498cd&scoped=true\"\nimport script from \"./CertificateView.vue?vue&type=script&lang=js\"\nexport * from \"./CertificateView.vue?vue&type=script&lang=js\"\n\nimport \"./CertificateView.vue?vue&type=style&index=0&id=641498cd&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-641498cd\"]])\n\nexport default __exports__","import request from './request'\n\n// 获取活动列表\nexport function getActivityList(params = {}) {\n  return request({\n    url: '/activities',\n    method: 'get',\n    params\n  })\n}\n\n// 获取活动详情\nexport function getActivityById(id) {\n  return request({\n    url: `/activities/${id}`,\n    method: 'get'\n  })\n}\n\n// 创建活动\nexport function createActivity(data) {\n  return request({\n    url: '/activities',\n    method: 'post',\n    data\n  })\n}\n\n// 更新活动\nexport function updateActivity(id, data) {\n  return request({\n    url: `/activities/${id}`,\n    method: 'put',\n    data\n  })\n}\n\n// 删除活动\nexport function deleteActivity(id) {\n  return request({\n    url: `/activities/${id}`,\n    method: 'delete'\n  })\n}\n\n// 根据状态获取活动列表\nexport function getActivitiesByStatus(status) {\n  return request({\n    url: `/activities/status/${status}`,\n    method: 'get'\n  })\n}\n\n// 报名参加活动\nexport function joinActivity(activityId) {\n  return request({\n    url: `/activities/${activityId}/register`,\n    method: 'post',\n    data: {} // 添加空对象作为data参数，确保请求格式正确\n  })\n}\n\n// 取消活动报名\nexport function cancelJoinActivity(activityId) {\n  return request({\n    url: `/activities/${activityId}/cancel-register`,\n    method: 'post'\n  })\n}\n\n// 生成参与证明\nexport function generateCertificate(activityId) {\n  return request({\n    url: `/activities/${activityId}/certificate`,\n    method: 'get'\n  })\n}\n\n// 下载参与名单\nexport function downloadParticipants(activityId, type = 'excel') {\n  return request({\n    url: `/activities/${activityId}/participants/export`,\n    method: 'get',\n    params: {\n      type: type\n    },\n    responseType: 'blob' // 重要：设置响应类型为blob\n  })\n}"],"names":["class","type","handleBack","loading","rows","animated","certificateData","studentName","formatDate","activityDate","activityTitle","activityType","organizer","issueDate","handlePrint","name","setup","router","route","store","activityDetail","Date","toISOString","certificateUrl","user","getters","userRole","userId","dateTime","date","isNaN","getTime","toLocaleDateString","year","month","day","getActivityTypeName","typeMap","loadActivityDetail","async","activityId","response","code","value","data","error","console","loadCertificateData","params","log","realStudentName","realName","username","nickname","success","title","startTime","errorMsg","message","push","window","print","__exports__","render","getActivityList","url","method","getActivityById","id","createActivity","updateActivity","deleteActivity","joinActivity","cancelJoinActivity","generateCertificate","downloadParticipants","responseType"],"sourceRoot":""}