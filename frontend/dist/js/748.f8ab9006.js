"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[748],{1748:function(e,t,a){a.r(t),a.d(t,{default:function(){return k}});var n=a(641),l=a(33);const r={class:"activity-list"},i={class:"page-header"},s={class:"search-container"},o={class:"table-container"},u={class:"pagination-container"};function c(e,t,a,c,d,g){const p=(0,n.g2)("Plus"),h=(0,n.g2)("el-icon"),f=(0,n.g2)("el-button"),m=(0,n.g2)("el-input"),b=(0,n.g2)("el-form-item"),v=(0,n.g2)("el-option"),y=(0,n.g2)("el-select"),k=(0,n.g2)("Search"),C=(0,n.g2)("Refresh"),E=(0,n.g2)("el-form"),F=(0,n.g2)("el-table-column"),w=(0,n.g2)("el-tag"),T=(0,n.g2)("el-table"),D=(0,n.g2)("el-pagination"),A=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("div",i,[t[6]||(t[6]=(0,n.Lk)("h1",null,"学术活动",-1)),c.hasPermission(["TEACHER","ADMIN"])?((0,n.uX)(),(0,n.Wv)(f,{key:0,type:"primary",onClick:c.handleCreate},{default:(0,n.k6)(()=>[(0,n.bF)(h,null,{default:(0,n.k6)(()=>[(0,n.bF)(p)]),_:1}),t[5]||(t[5]=(0,n.eW)(" 发布活动 ",-1))]),_:1},8,["onClick"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",s,[(0,n.bF)(E,{model:c.searchForm,inline:""},{default:(0,n.k6)(()=>[(0,n.bF)(b,{label:"活动标题"},{default:(0,n.k6)(()=>[(0,n.bF)(m,{modelValue:c.searchForm.title,"onUpdate:modelValue":t[0]||(t[0]=e=>c.searchForm.title=e),placeholder:"请输入活动标题",clearable:""},null,8,["modelValue"])]),_:1}),(0,n.bF)(b,{label:"活动类型"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{modelValue:c.searchForm.type,"onUpdate:modelValue":t[1]||(t[1]=e=>c.searchForm.type=e),style:{width:"120px"},placeholder:"请选择类型",clearable:""},{default:(0,n.k6)(()=>[(0,n.bF)(v,{label:"讲座",value:"LECTURE"}),(0,n.bF)(v,{label:"赛事",value:"COMPETITION"}),(0,n.bF)(v,{label:"培训",value:"TRAINING"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(b,{label:"状态"},{default:(0,n.k6)(()=>[(0,n.bF)(y,{modelValue:c.searchForm.status,"onUpdate:modelValue":t[2]||(t[2]=e=>c.searchForm.status=e),style:{width:"120px"},placeholder:"请选择状态",clearable:""},{default:(0,n.k6)(()=>[(0,n.bF)(v,{label:"草稿",value:"DRAFT"}),(0,n.bF)(v,{label:"已发布",value:"PUBLISHED"}),(0,n.bF)(v,{label:"已取消",value:"CANCELLED"}),(0,n.bF)(v,{label:"已完成",value:"COMPLETED"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(b,null,{default:(0,n.k6)(()=>[(0,n.bF)(f,{type:"primary",onClick:c.handleSearch},{default:(0,n.k6)(()=>[(0,n.bF)(h,null,{default:(0,n.k6)(()=>[(0,n.bF)(k)]),_:1}),t[7]||(t[7]=(0,n.eW)(" 搜索 ",-1))]),_:1},8,["onClick"]),(0,n.bF)(f,{onClick:c.handleReset},{default:(0,n.k6)(()=>[(0,n.bF)(h,null,{default:(0,n.k6)(()=>[(0,n.bF)(C)]),_:1}),t[8]||(t[8]=(0,n.eW)(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,n.Lk)("div",o,[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(T,{data:c.activityList},{default:(0,n.k6)(()=>[(0,n.bF)(F,{prop:"title",label:"活动标题","min-width":"200"}),(0,n.bF)(F,{prop:"type",label:"类型",width:"100"},{default:(0,n.k6)(e=>[(0,n.bF)(w,{type:c.getTypeTag(e.row.type)},{default:(0,n.k6)(()=>[(0,n.eW)((0,l.v_)(c.getTypeName(e.row.type)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(F,{prop:"organizer",label:"主办方",width:"150"}),(0,n.bF)(F,{prop:"location",label:"地点",width:"150"}),(0,n.bF)(F,{prop:"startTime",label:"开始时间",width:"180"}),(0,n.bF)(F,{prop:"currentParticipants",label:"参与人数",width:"100"}),(0,n.bF)(F,{prop:"status",label:"状态",width:"100"},{default:(0,n.k6)(e=>[(0,n.bF)(w,{type:c.getStatusTag(e.row.status)},{default:(0,n.k6)(()=>[(0,n.eW)((0,l.v_)(c.getStatusName(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(F,{label:"操作",width:"200",fixed:"right"},{default:(0,n.k6)(e=>[(0,n.bF)(f,{type:"primary",size:"small",onClick:t=>c.handleView(e.row)},{default:(0,n.k6)(()=>[...t[9]||(t[9]=[(0,n.eW)(" 查看 ",-1)])]),_:1},8,["onClick"]),"STUDENT"===c.userRole&&c.canJoin(e.row)&&!c.isUserRegistered(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:0,type:"success",size:"small",onClick:t=>c.handleJoin(e.row)},{default:(0,n.k6)(()=>[...t[10]||(t[10]=[(0,n.eW)(" 报名 ",-1)])]),_:1},8,["onClick"])):"STUDENT"===c.userRole&&c.isUserRegistered(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:1,type:"info",size:"small",disabled:""},{default:(0,n.k6)(()=>[...t[11]||(t[11]=[(0,n.eW)(" 已报名 ",-1)])]),_:1})):(0,n.Q3)("",!0),c.canEdit(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:2,type:"warning",size:"small",onClick:t=>c.handleEdit(e.row)},{default:(0,n.k6)(()=>[...t[12]||(t[12]=[(0,n.eW)(" 编辑 ",-1)])]),_:1},8,["onClick"])):(0,n.Q3)("",!0),c.canDelete(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:3,type:"danger",size:"small",onClick:t=>c.handleDelete(e.row)},{default:(0,n.k6)(()=>[...t[13]||(t[13]=[(0,n.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,n.Q3)("",!0)]),_:1})]),_:1},8,["data"])),[[A,c.loading]]),(0,n.Lk)("div",u,[(0,n.bF)(D,{"current-page":c.pagination.current,"onUpdate:currentPage":t[3]||(t[3]=e=>c.pagination.current=e),"page-size":c.pagination.size,"onUpdate:pageSize":t[4]||(t[4]=e=>c.pagination.size=e),total:c.pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c.handleSizeChange,onCurrentChange:c.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])}var d=a(953),g=a(5220),p=a(6278),h=a(163),f=a(7918),m=a(4930),b={name:"ActivityList",setup(){const e=(0,g.rd)(),t=(0,p.Pj)(),a=(0,d.KR)(!1),l=(0,d.KR)([]),r=(0,d.Kh)({title:"",type:"",status:""}),i=(0,d.Kh)({current:1,size:10,total:0}),s=(0,n.EW)(()=>t.getters.userRole),o=(0,n.EW)(()=>t.getters.userId),u=e=>e.includes(s.value),c=e=>{const t={LECTURE:"讲座",COMPETITION:"赛事",TRAINING:"培训"};return t[e]||e},b=e=>{const t={LECTURE:"primary",COMPETITION:"success",TRAINING:"warning"};return t[e]||"info"},v=e=>{const t={DRAFT:"草稿",PUBLISHED:"已发布",CANCELLED:"已取消",COMPLETED:"已完成"};return t[e]||e},y=e=>{const t={DRAFT:"info",PUBLISHED:"success",CANCELLED:"danger",COMPLETED:"warning"};return t[e]||"info"},k=e=>{if(console.log("判断报名状态 - 活动ID:",e.id,"用户ID:",o.value),!e)return console.log("活动对象不存在"),!1;if("boolean"===typeof e.hasRegistered)return console.log("通过hasRegistered字段检查结果:",e.hasRegistered),e.hasRegistered;if(e.registeredUsers&&Array.isArray(e.registeredUsers)){const t=e.registeredUsers.includes(o.value);return console.log("通过registeredUsers检查结果:",t),t}if(e.registrations&&Array.isArray(e.registrations)){const t=e.registrations.some(e=>e.userId===o.value);return console.log("通过registrations检查结果:",t),t}return!1},C=e=>"STUDENT"===s.value&&"PUBLISHED"===e.status&&new Date(e.registrationDeadline)>new Date,E=e=>u(["TEACHER","ADMIN"])&&"COMPLETED"!==e.status,F=e=>u(["ADMIN"])||u(["TEACHER"])&&"DRAFT"===e.status,w=async()=>{a.value=!0;try{console.log("当前登录用户ID:",o.value,"角色:",s.value);const e={page:i.current,pageSize:i.size};if(r.title){const t=r.title.trim();t&&(e.title=t)}r.type&&(e.type=r.type),r.status&&(e.status=r.status),console.log("发送搜索参数:",e);const t=await(0,m.ES)(e);if(console.log("API响应:",t),200===t.code){const a=t.data;l.value=Array.isArray(a)?a:a.records||[],i.total=a.total||l.value.length,console.log("加载到的活动数量:",l.value.length),console.log("设置的分页总数:",i.total);const n=!!e.title||!!e.type||!!e.status;n&&(console.log("存在搜索条件，检查后端过滤是否生效"),e.type&&(l.value=l.value.filter(t=>t.type===e.type),console.log("前端按类型过滤后数量:",l.value.length)),e.status&&(l.value=l.value.filter(t=>t.status===e.status),console.log("前端按状态过滤后数量:",l.value.length)),e.title&&(l.value=l.value.filter(t=>t.title.toLowerCase().includes(e.title.toLowerCase())),console.log("前端按标题过滤后数量:",l.value.length)),i.total=l.value.length),l.value.forEach(e=>{const t=k(e);console.log(`活动 ${e.title} (ID:${e.id}) - 用户是否已报名:`,t)})}else h.nk.error(t.message||"加载活动列表失败"),l.value=[],i.total=0}catch(e){h.nk.error("加载活动列表失败"),l.value=[],i.total=0}finally{a.value=!1}},T=()=>{i.current=1,w()},D=()=>{Object.assign(r,{title:"",type:"",status:""}),T()},A=()=>{e.push("/dashboard/activities/create")},_=t=>{e.push(`/dashboard/activities/${t.id}`)},I=e=>{e.id?new Date(e.registrationDeadline)<=new Date?h.nk.warning("报名已截止"):e.currentParticipants>=e.maxParticipants?h.nk.warning("活动人数已满"):k(e)?h.nk.warning("您已报名该活动"):f.s.confirm("确定要报名参加此活动吗？","确认报名",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await(0,m.Kg)(e.id);200===t.code||t.success?(h.nk.success(t.message||"报名成功"),w()):h.nk.error(t.message||"报名失败")}catch(t){const e=t.response?.data?.message||t.message||"报名失败，请稍后重试";h.nk.error(e)}}):h.nk.error("活动信息错误，无法报名")},R=t=>{e.push(`/dashboard/activities/${t.id}/edit`)},L=e=>{f.s.confirm("确定要删除此活动吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const t=await(0,m.$y)(e.id);200===t.code?(h.nk.success(t.message||"删除成功"),w()):h.nk.error(t.message||"删除失败")}catch(t){h.nk.error("删除失败，请稍后重试")}})},N=e=>{i.size=e,w()},z=e=>{i.current=e,w()};return(0,n.sV)(()=>{w()}),{loading:a,activityList:l,searchForm:r,pagination:i,userRole:s,userId:o,hasPermission:u,getTypeName:c,getTypeTag:b,getStatusName:v,getStatusTag:y,isUserRegistered:k,canJoin:C,canEdit:E,canDelete:F,handleSearch:T,handleReset:D,handleCreate:A,handleView:_,handleJoin:I,handleEdit:R,handleDelete:L,handleSizeChange:N,handleCurrentChange:z}}},v=a(6262);const y=(0,v.A)(b,[["render",c],["__scopeId","data-v-7e5e5917"]]);var k=y},4930:function(e,t,a){a.d(t,{$y:function(){return o},BQ:function(){return d},E1:function(){return i},ES:function(){return l},IE:function(){return c},J0:function(){return s},Kg:function(){return u},qP:function(){return r},zW:function(){return g}});var n=a(86);function l(e={}){return(0,n.A)({url:"/activities",method:"get",params:e})}function r(e){return(0,n.A)({url:`/activities/${e}`,method:"get"})}function i(e){return(0,n.A)({url:"/activities",method:"post",data:e})}function s(e,t){return(0,n.A)({url:`/activities/${e}`,method:"put",data:t})}function o(e){return(0,n.A)({url:`/activities/${e}`,method:"delete"})}function u(e){return(0,n.A)({url:`/activities/${e}/register`,method:"post",data:{}})}function c(e){return(0,n.A)({url:`/activities/${e}/cancel-register`,method:"post"})}function d(e){return(0,n.A)({url:`/activities/${e}/certificate`,method:"get"})}function g(e,t="excel"){return(0,n.A)({url:`/activities/${e}/participants/export`,method:"get",params:{type:t},responseType:"blob"})}}}]);
//# sourceMappingURL=748.f8ab9006.js.map