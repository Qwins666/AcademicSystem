"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[193],{193:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var l=a(641),r=a(33),i=a(3751);const o={class:"activity-form"},n={class:"page-header"},u={class:"form-container"};function d(e,t,a,d,s,m){const c=(0,l.g2)("ArrowLeft"),f=(0,l.g2)("el-icon"),p=(0,l.g2)("el-button"),g=(0,l.g2)("el-input"),b=(0,l.g2)("el-form-item"),h=(0,l.g2)("el-option"),k=(0,l.g2)("el-select"),v=(0,l.g2)("el-date-picker"),F=(0,l.g2)("el-col"),_=(0,l.g2)("el-row"),V=(0,l.g2)("el-input-number"),y=(0,l.g2)("el-radio"),T=(0,l.g2)("el-radio-group"),D=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",n,[(0,l.Lk)("h1",null,(0,r.v_)(d.isEdit?"编辑活动":"发布活动"),1),(0,l.bF)(p,{onClick:d.handleBack},{default:(0,l.k6)(()=>[(0,l.bF)(f,null,{default:(0,l.k6)(()=>[(0,l.bF)(c)]),_:1}),t[10]||(t[10]=(0,l.eW)(" 返回 ",-1))]),_:1},8,["onClick"])]),(0,l.Lk)("div",u,[(0,l.bF)(D,{ref:"formRef",model:d.form,rules:d.rules,"label-width":"120px",onSubmit:(0,i.D$)(d.handleSubmit,["prevent"])},{default:(0,l.k6)(()=>[(0,l.bF)(b,{label:"活动标题",prop:"title"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{modelValue:d.form.title,"onUpdate:modelValue":t[0]||(t[0]=e=>d.form.title=e),placeholder:"请输入活动标题",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"活动类型",prop:"type"},{default:(0,l.k6)(()=>[(0,l.bF)(k,{modelValue:d.form.type,"onUpdate:modelValue":t[1]||(t[1]=e=>d.form.type=e),placeholder:"请选择活动类型",style:{width:"100%"}},{default:(0,l.k6)(()=>[(0,l.bF)(h,{label:"讲座",value:"LECTURE"}),(0,l.bF)(h,{label:"赛事",value:"COMPETITION"}),(0,l.bF)(h,{label:"培训",value:"TRAINING"})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"活动描述",prop:"description"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{modelValue:d.form.description,"onUpdate:modelValue":t[2]||(t[2]=e=>d.form.description=e),type:"textarea",rows:4,placeholder:"请输入活动描述",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"主办方",prop:"organizer"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{modelValue:d.form.organizer,"onUpdate:modelValue":t[3]||(t[3]=e=>d.form.organizer=e),placeholder:"请输入主办方",maxlength:"100"},null,8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"活动地点",prop:"location"},{default:(0,l.k6)(()=>[(0,l.bF)(g,{modelValue:d.form.location,"onUpdate:modelValue":t[4]||(t[4]=e=>d.form.location=e),placeholder:"请输入活动地点",maxlength:"200"},null,8,["modelValue"])]),_:1}),(0,l.bF)(_,{gutter:20},{default:(0,l.k6)(()=>[(0,l.bF)(F,{span:12},{default:(0,l.k6)(()=>[(0,l.bF)(b,{label:"开始时间",prop:"startTime"},{default:(0,l.k6)(()=>[(0,l.bF)(v,{modelValue:d.form.startTime,"onUpdate:modelValue":t[5]||(t[5]=e=>d.form.startTime=e),type:"datetime",placeholder:"选择开始时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),(0,l.bF)(F,{span:12},{default:(0,l.k6)(()=>[(0,l.bF)(b,{label:"结束时间",prop:"endTime"},{default:(0,l.k6)(()=>[(0,l.bF)(v,{modelValue:d.form.endTime,"onUpdate:modelValue":t[6]||(t[6]=e=>d.form.endTime=e),type:"datetime",placeholder:"选择结束时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,l.bF)(b,{label:"报名截止时间",prop:"registrationDeadline"},{default:(0,l.k6)(()=>[(0,l.bF)(v,{modelValue:d.form.registrationDeadline,"onUpdate:modelValue":t[7]||(t[7]=e=>d.form.registrationDeadline=e),type:"datetime",placeholder:"选择报名截止时间",style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"最大参与人数"},{default:(0,l.k6)(()=>[(0,l.bF)(V,{modelValue:d.form.maxParticipants,"onUpdate:modelValue":t[8]||(t[8]=e=>d.form.maxParticipants=e),min:1,max:1e3,placeholder:"请输入最大参与人数",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,l.bF)(b,{label:"活动状态",prop:"status"},{default:(0,l.k6)(()=>[(0,l.bF)(T,{modelValue:d.form.status,"onUpdate:modelValue":t[9]||(t[9]=e=>d.form.status=e)},{default:(0,l.k6)(()=>[(0,l.bF)(y,{label:"DRAFT"},{default:(0,l.k6)(()=>[...t[11]||(t[11]=[(0,l.eW)("草稿",-1)])]),_:1}),(0,l.bF)(y,{label:"PUBLISHED"},{default:(0,l.k6)(()=>[...t[12]||(t[12]=[(0,l.eW)("发布",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,l.bF)(b,null,{default:(0,l.k6)(()=>[(0,l.bF)(p,{type:"primary",loading:d.loading,onClick:d.handleSubmit},{default:(0,l.k6)(()=>[(0,l.eW)((0,r.v_)(d.isEdit?"更新":"发布"),1)]),_:1},8,["loading","onClick"]),(0,l.bF)(p,{onClick:d.handleReset},{default:(0,l.k6)(()=>[...t[13]||(t[13]=[(0,l.eW)("重置",-1)])]),_:1},8,["onClick"]),(0,l.bF)(p,{onClick:d.handleBack},{default:(0,l.k6)(()=>[...t[14]||(t[14]=[(0,l.eW)("取消",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","onSubmit"])])])}var s=a(953),m=a(5220),c=a(163),f=a(4930),p={name:"ActivityForm",setup(){const e=(0,m.rd)(),t=(0,m.lq)(),a=(0,s.KR)(),r=(0,s.KR)(!1),i=(0,l.EW)(()=>!!t.params.id),o=(0,s.Kh)({title:"",type:"",description:"",organizer:"",location:"",startTime:"",endTime:"",registrationDeadline:"",maxParticipants:100,status:"DRAFT"}),n={title:[{required:!0,message:"请输入活动标题",trigger:"blur"},{min:2,max:200,message:"标题长度在2到200个字符",trigger:"blur"}],type:[{required:!0,message:"请选择活动类型",trigger:"change"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur"},{min:10,max:1e3,message:"描述长度在10到1000个字符",trigger:"blur"}],organizer:[{required:!0,message:"请输入主办方",trigger:"blur"}],location:[{required:!0,message:"请输入活动地点",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],registrationDeadline:[{required:!0,message:"请选择报名截止时间",trigger:"change"}],status:[{required:!0,message:"请选择活动状态",trigger:"change"}]},u=e=>e?e.replace("T"," "):"",d=e=>e?e.includes("T")?e:e.replace(" ","T"):"",p=async()=>{if(i.value)try{r.value=!0;const e=await(0,f.qP)(t.params.id);if(200===e.code){const t={...e.data};t.startTime&&(t.startTime=d(t.startTime)),t.endTime&&(t.endTime=d(t.endTime)),t.registrationDeadline&&(t.registrationDeadline=d(t.registrationDeadline)),Object.assign(o,t)}else c.nk.error(e.message||"加载活动数据失败")}catch(e){c.nk.error("加载活动数据失败，请稍后重试")}finally{r.value=!1}},g=async()=>{a.value&&await a.value.validate(async a=>{if(a){r.value=!0,console.log("开始加载...");try{const a={title:o.title,type:o.type,description:o.description,organizer:o.organizer,location:o.location,startTime:u(o.startTime),endTime:u(o.endTime),registrationDeadline:u(o.registrationDeadline),maxParticipants:o.maxParticipants,status:o.status},l=i.value?await(0,f.J0)(t.params.id,a):await(0,f.E1)(a);console.log("结束加载...响应数据:",l.data,"isEdit.value数据:",i.value),200===l.code?(c.nk.success(l.message||(i.value?"活动更新成功":"活动发布成功")),e.push("/dashboard/activities")):c.nk.error(l.message||(i.value?"活动更新失败":"活动发布失败"))}catch(l){c.nk.error("操作失败，请稍后重试")}finally{r.value=!1}}})},b=()=>{a.value&&a.value.resetFields()},h=()=>{e.push("/dashboard/activities")};return(0,l.sV)(()=>{p()}),{formRef:a,loading:r,isEdit:i,form:o,rules:n,handleSubmit:g,handleReset:b,handleBack:h}}},g=a(6262);const b=(0,g.A)(p,[["render",d],["__scopeId","data-v-20a621f0"]]);var h=b},4930:function(e,t,a){a.d(t,{$y:function(){return u},BQ:function(){return m},E1:function(){return o},ES:function(){return r},IE:function(){return s},J0:function(){return n},Kg:function(){return d},qP:function(){return i},zW:function(){return c}});var l=a(86);function r(e={}){return(0,l.A)({url:"/activities",method:"get",params:e})}function i(e){return(0,l.A)({url:`/activities/${e}`,method:"get"})}function o(e){return(0,l.A)({url:"/activities",method:"post",data:e})}function n(e,t){return(0,l.A)({url:`/activities/${e}`,method:"put",data:t})}function u(e){return(0,l.A)({url:`/activities/${e}`,method:"delete"})}function d(e){return(0,l.A)({url:`/activities/${e}/register`,method:"post",data:{}})}function s(e){return(0,l.A)({url:`/activities/${e}/cancel-register`,method:"post"})}function m(e){return(0,l.A)({url:`/activities/${e}/certificate`,method:"get"})}function c(e,t="excel"){return(0,l.A)({url:`/activities/${e}/participants/export`,method:"get",params:{type:t},responseType:"blob"})}}}]);
//# sourceMappingURL=193.8ba8a6a4.js.map