"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[867],{1248:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var n=a(641),r=a(33);const l={class:"project-list"},o={class:"page-header"},u={class:"search-container"},i={class:"table-container"},s={key:0},c={class:"pagination-container"};function d(e,t,a,d,p,h){const g=(0,n.g2)("Plus"),m=(0,n.g2)("el-icon"),f=(0,n.g2)("el-button"),b=(0,n.g2)("el-input"),k=(0,n.g2)("el-form-item"),C=(0,n.g2)("el-option"),N=(0,n.g2)("el-select"),v=(0,n.g2)("Search"),y=(0,n.g2)("Refresh"),A=(0,n.g2)("el-form"),F=(0,n.g2)("el-table-column"),w=(0,n.g2)("el-tag"),E=(0,n.g2)("el-table"),_=(0,n.g2)("el-pagination"),L=(0,n.gN)("loading");return(0,n.uX)(),(0,n.CE)("div",l,[(0,n.Lk)("div",o,[t[6]||(t[6]=(0,n.Lk)("h1",null,"科研项目",-1)),d.hasPermission(["TEACHER","ADMIN"])?((0,n.uX)(),(0,n.Wv)(f,{key:0,type:"primary",onClick:d.handleCreate},{default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[(0,n.bF)(g)]),_:1}),t[5]||(t[5]=(0,n.eW)(" 创建项目 ",-1))]),_:1},8,["onClick"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",u,[(0,n.bF)(A,{model:d.searchForm,inline:""},{default:(0,n.k6)(()=>[(0,n.bF)(k,{label:"项目名称"},{default:(0,n.k6)(()=>[(0,n.bF)(b,{modelValue:d.searchForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.searchForm.name=e),placeholder:"请输入项目名称",clearable:""},null,8,["modelValue"])]),_:1}),(0,n.bF)(k,{label:"项目类型"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{modelValue:d.searchForm.type,"onUpdate:modelValue":t[1]||(t[1]=e=>d.searchForm.type=e),style:{width:"120px"},placeholder:"请选择类型",clearable:""},{default:(0,n.k6)(()=>[(0,n.bF)(C,{label:"研究项目",value:"RESEARCH"}),(0,n.bF)(C,{label:"创新项目",value:"INNOVATION"}),(0,n.bF)(C,{label:"实践项目",value:"PRACTICE"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(k,{label:"项目状态"},{default:(0,n.k6)(()=>[(0,n.bF)(N,{modelValue:d.searchForm.status,"onUpdate:modelValue":t[2]||(t[2]=e=>d.searchForm.status=e),style:{width:"120px"},placeholder:"请选择状态",clearable:""},{default:(0,n.k6)(()=>[(0,n.bF)(C,{label:"规划中",value:"PLANNING"}),(0,n.bF)(C,{label:"进行中",value:"ONGOING"}),(0,n.bF)(C,{label:"已完成",value:"COMPLETED"}),(0,n.bF)(C,{label:"已取消",value:"CANCELLED"})]),_:1},8,["modelValue"])]),_:1}),(0,n.bF)(k,null,{default:(0,n.k6)(()=>[(0,n.bF)(f,{type:"primary",onClick:d.handleSearch},{default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[(0,n.bF)(v)]),_:1}),t[7]||(t[7]=(0,n.eW)(" 搜索 ",-1))]),_:1},8,["onClick"]),(0,n.bF)(f,{onClick:d.handleReset},{default:(0,n.k6)(()=>[(0,n.bF)(m,null,{default:(0,n.k6)(()=>[(0,n.bF)(y)]),_:1}),t[8]||(t[8]=(0,n.eW)(" 重置 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,n.Lk)("div",i,[(0,n.bo)(((0,n.uX)(),(0,n.Wv)(E,{data:d.projectList},{default:(0,n.k6)(()=>[(0,n.bF)(F,{prop:"name",label:"项目名称","min-width":"200"}),(0,n.bF)(F,{prop:"type",label:"类型",width:"100"},{default:(0,n.k6)(e=>[(0,n.bF)(w,{type:d.getTypeTag(e.row.type)},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(d.getTypeName(e.row.type)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(F,{prop:"level",label:"级别",width:"100"},{default:(0,n.k6)(e=>[e.row.level?((0,n.uX)(),(0,n.Wv)(w,{key:0,type:d.getLevelTag(e.row.level)},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(d.getLevelName(e.row.level)),1)]),_:2},1032,["type"])):(0,n.Q3)("",!0)]),_:1}),(0,n.bF)(F,{prop:"leaderName",label:"负责人",width:"120"}),(0,n.bF)(F,{prop:"funding",label:"经费",width:"120"},{default:(0,n.k6)(e=>[e.row.funding?((0,n.uX)(),(0,n.CE)("span",s,"¥"+(0,r.v_)(e.row.funding.toLocaleString()),1)):(0,n.Q3)("",!0)]),_:1}),(0,n.bF)(F,{prop:"startDate",label:"开始日期",width:"120"}),(0,n.bF)(F,{prop:"endDate",label:"结束日期",width:"120"}),(0,n.bF)(F,{prop:"status",label:"状态",width:"100"},{default:(0,n.k6)(e=>[(0,n.bF)(w,{type:d.getStatusTag(e.row.status)},{default:(0,n.k6)(()=>[(0,n.eW)((0,r.v_)(d.getStatusName(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,n.bF)(F,{label:"操作",width:"200",fixed:"right"},{default:(0,n.k6)(e=>[(0,n.bF)(f,{type:"primary",size:"small",onClick:t=>d.handleView(e.row)},{default:(0,n.k6)(()=>[...t[9]||(t[9]=[(0,n.eW)(" 查看 ",-1)])]),_:1},8,["onClick"]),d.canEdit(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:0,type:"warning",size:"small",onClick:t=>d.handleEdit(e.row)},{default:(0,n.k6)(()=>[...t[10]||(t[10]=[(0,n.eW)(" 编辑 ",-1)])]),_:1},8,["onClick"])):(0,n.Q3)("",!0),d.canJoin(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:1,type:"success",size:"small",onClick:t=>d.handleJoin(e.row)},{default:(0,n.k6)(()=>[...t[11]||(t[11]=[(0,n.eW)(" 加入 ",-1)])]),_:1},8,["onClick"])):(0,n.Q3)("",!0),d.canDelete(e.row)?((0,n.uX)(),(0,n.Wv)(f,{key:2,type:"danger",size:"small",onClick:t=>d.handleDelete(e.row)},{default:(0,n.k6)(()=>[...t[12]||(t[12]=[(0,n.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,n.Q3)("",!0)]),_:1})]),_:1},8,["data"])),[[L,d.loading]]),(0,n.Lk)("div",c,[(0,n.bF)(_,{"current-page":d.pagination.current,"onUpdate:currentPage":t[3]||(t[3]=e=>d.pagination.current=e),"page-size":d.pagination.size,"onUpdate:pageSize":t[4]||(t[4]=e=>d.pagination.size=e),total:d.pagination.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])])])}var p=a(953),h=a(5220),g=a(6278),m=a(163),f=a(7918),b=a(6698),k={name:"ProjectList",setup(){const e=(0,h.rd)(),t=(0,g.Pj)(),a=(0,p.KR)(!1),r=(0,p.KR)([]),l=(0,p.Kh)({name:"",type:"",status:""}),o=(0,p.KR)(t.state.user?.id||1),u=(0,p.Kh)({current:1,size:10,total:0}),i=(0,n.EW)(()=>t.getters.userRole),s=e=>e.includes(i.value),c=e=>{const t={RESEARCH:"研究项目",INNOVATION:"创新项目",PRACTICE:"实践项目"};return t[e]||e},d=e=>{const t={RESEARCH:"primary",INNOVATION:"success",PRACTICE:"warning"};return t[e]||"info"},k=e=>{const t={NATIONAL:"国家级",PROVINCIAL:"省级",SCHOOL:"校级"};return t[e]||e},C=e=>{const t={NATIONAL:"danger",PROVINCIAL:"warning",SCHOOL:"success"};return t[e]||"info"},N=e=>{const t={PLANNING:"规划中",ONGOING:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||e},v=e=>{const t={PLANNING:"info",ONGOING:"success",COMPLETED:"warning",CANCELLED:"danger"};return t[e]||"info"},y=e=>s(["TEACHER","ADMIN"])&&e.leaderId===o.value&&"COMPLETED"!==e.status,A=e=>"STUDENT"===i.value&&"ONGOING"===e.status,F=e=>s(["ADMIN"])||s(["TEACHER"])&&e.leaderId===o.value&&"PLANNING"===e.status,w=async()=>{a.value=!0;try{const t={page:u.current,pageSize:u.size,name:l.name,type:l.type,status:l.status},a=await(0,b.cf)(t);if(r.value=a.data||a||[],u.total=a.total||r.value.length,r.value&&r.value.length>0)for(const n of r.value)if(n.leaderId&&!n.leaderName)try{const e=await(0,b.J2)(n.leaderId),t=e.data||e;t.realName?n.leaderName=t.realName:n.leaderName="未知负责人"}catch(e){console.warn(`获取项目 ${n.id} 负责人信息失败:`,e),n.leaderName="未知负责人"}}catch(t){console.error("加载项目列表失败:",t),m.nk.error("加载项目列表失败"),u.total=r.value.length}finally{a.value=!1}},E=()=>{u.current=1,w()},_=()=>{Object.assign(l,{name:"",type:"",status:""}),E()},L=()=>{e.push("/dashboard/projects/create")},I=t=>{e.push(`/dashboard/projects/${t.id}`)},T=t=>{e.push(`/dashboard/projects/${t.id}/edit`)},j=e=>{f.s.confirm("确定要加入此项目吗？","确认加入",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,b.pH)(e.id,o.value),m.nk.success("加入项目成功"),w()}catch(t){console.error("加入项目失败:",t),m.nk.error("加入项目失败")}})},O=e=>{f.s.confirm("确定要删除此项目吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,b.xx)(e.id),m.nk.success("删除成功"),w()}catch(t){console.error("删除项目失败:",t),m.nk.error("删除项目失败")}})},R=e=>{u.size=e,w()},z=e=>{u.current=e,w()};return(0,n.sV)(()=>{w()}),{loading:a,projectList:r,searchForm:l,pagination:u,hasPermission:s,getTypeName:c,getTypeTag:d,getLevelName:k,getLevelTag:C,getStatusName:N,getStatusTag:v,canEdit:y,canJoin:A,canDelete:F,handleSearch:E,handleReset:_,handleCreate:L,handleView:I,handleEdit:T,handleJoin:j,handleDelete:O,handleSizeChange:R,handleCurrentChange:z}}},C=a(6262);const N=(0,C.A)(k,[["render",d],["__scopeId","data-v-75c227ee"]]);var v=N},6698:function(e,t,a){a.d(t,{CE:function(){return h},G6:function(){return l},J2:function(){return b},Rv:function(){return m},cf:function(){return r},gA:function(){return o},hr:function(){return d},iz:function(){return k},jY:function(){return g},jh:function(){return p},nB:function(){return f},pH:function(){return s},vr:function(){return u},wV:function(){return c},xx:function(){return i}});var n=a(86);function r(e={}){return(0,n.A)({url:"/projects",method:"get",params:e})}function l(e){return(0,n.A)({url:`/projects/${e}`,method:"get"})}function o(e){return(0,n.A)({url:"/projects",method:"post",data:e})}function u(e,t){return(0,n.A)({url:`/projects/${e}`,method:"put",data:t})}function i(e){return(0,n.A)({url:`/projects/${e}`,method:"delete"})}function s(e,t){return(0,n.A)({url:`/projects/${e}/members`,method:"post",data:{memberId:t,role:"MEMBER"}})}function c(e,t){return(0,n.A)({url:`/projects/${e}/members/${t}`,method:"delete"})}function d(e){return(0,n.A)({url:`/projects/${e}/members`,method:"get"})}function p(e,t){return(0,n.A)({url:`/projects/${e}/milestones`,method:"post",data:t})}function h(e,t,a){return(0,n.A)({url:`/projects/${e}/milestones/${t}`,method:"put",data:a})}function g(e){return(0,n.A)({url:`/projects/${e}/milestones`,method:"get"})}function m(e){return(0,n.A)({url:`/projects/${e}/files`,method:"get"})}function f(e,t){return(0,n.A)({url:`/projects/${e}/files/${t}`,method:"delete"})}function b(e){return(0,n.A)({url:`/projects/leaderDetail/${e}`,method:"get"})}function k(){return(0,n.A)({url:"/projects/available-students",method:"get"})}}}]);
//# sourceMappingURL=867.e73e0c4c.js.map