"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[175],{1356:function(e,t,l){l.d(t,{LB:function(){return i},TK:function(){return o},aU:function(){return n},cw:function(){return d},hG:function(){return r},l:function(){return u},pU:function(){return s}});var a=l(86);function n(e){return(0,a.A)({url:"/users",method:"get",params:e})}function o(e,t){return(0,a.A)({url:`/users/${e}`,method:"put",data:t})}function r(e){return(0,a.A)({url:`/users/${e}`,method:"delete"})}function s(e,t){return(0,a.A)({url:`/users/${e}/status`,method:"put",data:{status:t}})}function i(e){return(0,a.A)({url:`/auth/approve-user/${e}`,method:"post"})}function u(e){return(0,a.A)({url:`/auth/reject-user/${e}`,method:"post"})}function d(e){return(0,a.A)({url:`/users/${e}/reset-password`,method:"put"})}},6698:function(e,t,l){l.d(t,{CE:function(){return p},G6:function(){return o},J2:function(){return v},Rv:function(){return f},cf:function(){return n},gA:function(){return r},hr:function(){return c},iz:function(){return y},jY:function(){return k},jh:function(){return m},nB:function(){return g},pH:function(){return u},vr:function(){return s},wV:function(){return d},xx:function(){return i}});var a=l(86);function n(e={}){return(0,a.A)({url:"/projects",method:"get",params:e})}function o(e){return(0,a.A)({url:`/projects/${e}`,method:"get"})}function r(e){return(0,a.A)({url:"/projects",method:"post",data:e})}function s(e,t){return(0,a.A)({url:`/projects/${e}`,method:"put",data:t})}function i(e){return(0,a.A)({url:`/projects/${e}`,method:"delete"})}function u(e,t){return(0,a.A)({url:`/projects/${e}/members`,method:"post",data:{memberId:t,role:"MEMBER"}})}function d(e,t){return(0,a.A)({url:`/projects/${e}/members/${t}`,method:"delete"})}function c(e){return(0,a.A)({url:`/projects/${e}/members`,method:"get"})}function m(e,t){return(0,a.A)({url:`/projects/${e}/milestones`,method:"post",data:t})}function p(e,t,l){return(0,a.A)({url:`/projects/${e}/milestones/${t}`,method:"put",data:l})}function k(e){return(0,a.A)({url:`/projects/${e}/milestones`,method:"get"})}function f(e){return(0,a.A)({url:`/projects/${e}/files`,method:"get"})}function g(e,t){return(0,a.A)({url:`/projects/${e}/files/${t}`,method:"delete"})}function v(e){return(0,a.A)({url:`/projects/leaderDetail/${e}`,method:"get"})}function y(){return(0,a.A)({url:"/projects/available-students",method:"get"})}},8175:function(e,t,l){l.r(t),l.d(t,{default:function(){return Z}});var a=l(641),n=l(33);const o={class:"project-detail"},r={class:"page-header"},s={class:"header-actions"},i={class:"info-content"},u={class:"info-row"},d={class:"info-item"},c={class:"info-item"},m={class:"info-item"},p={class:"info-item"},k={class:"info-row"},f={class:"info-item"},g={class:"info-item"},v={class:"info-item"},y={class:"info-item"},h={class:"info-row full-width"},b={class:"info-item full-width"},E={class:"description-content"},L={class:"tab-content"},w={class:"tab-header"},I={class:"tab-content"},D={class:"tab-header"},F={class:"milestone-timeline"},C={class:"milestone-container"},M={class:"milestone-header"},N={class:"milestone-number"},_={class:"milestone-info"},A={class:"milestone-due-date"},j={key:0,class:"milestone-content"},T={class:"milestone-description"},O={key:0,class:"milestone-files"},B={key:0,class:"milestone-file-list"},W=["href"],P={key:1,class:"milestone-actions"},R={class:"tab-content"},S={class:"tab-header"},U=["href"],V={class:"dialog-footer"},$={class:"dialog-footer"};function x(e,t,l,x,K,X){const G=(0,a.g2)("ArrowLeft"),z=(0,a.g2)("el-icon"),Q=(0,a.g2)("el-button"),Y=(0,a.g2)("el-tag"),H=(0,a.g2)("el-card"),J=(0,a.g2)("Plus"),q=(0,a.g2)("el-table-column"),Z=(0,a.g2)("el-table"),ee=(0,a.g2)("el-tab-pane"),te=(0,a.g2)("UploadFilled"),le=(0,a.g2)("el-upload"),ae=(0,a.g2)("el-tabs"),ne=(0,a.g2)("el-option"),oe=(0,a.g2)("el-select"),re=(0,a.g2)("el-form-item"),se=(0,a.g2)("el-form"),ie=(0,a.g2)("el-dialog"),ue=(0,a.g2)("el-input"),de=(0,a.g2)("el-date-picker"),ce=(0,a.gN)("loading");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",r,[(0,a.Lk)("h1",null,(0,n.v_)(x.project.name||"项目详情"),1),(0,a.Lk)("div",s,[(0,a.bF)(Q,{onClick:x.handleBack},{default:(0,a.k6)(()=>[(0,a.bF)(z,null,{default:(0,a.k6)(()=>[(0,a.bF)(G)]),_:1}),t[10]||(t[10]=(0,a.eW)(" 返回列表 ",-1))]),_:1},8,["onClick"]),x.canEdit?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"primary",onClick:x.handleEdit},{default:(0,a.k6)(()=>[...t[11]||(t[11]=[(0,a.eW)(" 编辑项目 ",-1)])]),_:1},8,["onClick"])):(0,a.Q3)("",!0)])]),(0,a.bo)(((0,a.uX)(),(0,a.Wv)(H,{class:"info-card"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",i,[(0,a.Lk)("div",u,[(0,a.Lk)("div",d,[t[12]||(t[12]=(0,a.Lk)("label",null,"项目名称：",-1)),(0,a.Lk)("span",null,(0,n.v_)(x.project.name),1)]),(0,a.Lk)("div",c,[t[13]||(t[13]=(0,a.Lk)("label",null,"项目类型：",-1)),(0,a.bF)(Y,{type:x.getTypeTag(x.project.type)},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(x.getTypeName(x.project.type)),1)]),_:1},8,["type"])]),(0,a.Lk)("div",m,[t[14]||(t[14]=(0,a.Lk)("label",null,"项目级别：",-1)),(0,a.bF)(Y,{type:x.getLevelTag(x.project.level)},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(x.getLevelName(x.project.level)),1)]),_:1},8,["type"])]),(0,a.Lk)("div",p,[t[15]||(t[15]=(0,a.Lk)("label",null,"项目状态：",-1)),(0,a.bF)(Y,{type:x.getStatusTag(x.project.status)},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(x.getStatusName(x.project.status)),1)]),_:1},8,["type"])])]),(0,a.Lk)("div",k,[(0,a.Lk)("div",f,[t[16]||(t[16]=(0,a.Lk)("label",null,"项目负责人：",-1)),(0,a.Lk)("span",null,(0,n.v_)(x.project.leaderName),1)]),(0,a.Lk)("div",g,[t[17]||(t[17]=(0,a.Lk)("label",null,"项目经费：",-1)),(0,a.Lk)("span",null,"¥"+(0,n.v_)(x.project.funding?x.project.funding.toLocaleString():"0.00"),1)]),(0,a.Lk)("div",v,[t[18]||(t[18]=(0,a.Lk)("label",null,"开始日期：",-1)),(0,a.Lk)("span",null,(0,n.v_)(x.project.startDate),1)]),(0,a.Lk)("div",y,[t[19]||(t[19]=(0,a.Lk)("label",null,"结束日期：",-1)),(0,a.Lk)("span",null,(0,n.v_)(x.project.endDate),1)])]),(0,a.Lk)("div",h,[(0,a.Lk)("div",b,[t[20]||(t[20]=(0,a.Lk)("label",null,"项目描述：",-1)),(0,a.Lk)("div",E,(0,n.v_)(x.project.description),1)])])])]),_:1})),[[ce,x.loading]]),(0,a.bF)(ae,{modelValue:x.activeTab,"onUpdate:modelValue":t[1]||(t[1]=e=>x.activeTab=e),class:"project-tabs"},{default:(0,a.k6)(()=>[(0,a.bF)(ee,{label:"项目成员",name:"members"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",L,[(0,a.Lk)("div",w,[t[22]||(t[22]=(0,a.Lk)("h3",null,"成员列表",-1)),x.canEdit?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"primary",onClick:t[0]||(t[0]=e=>x.showInviteDialog=!0)},{default:(0,a.k6)(()=>[(0,a.bF)(z,null,{default:(0,a.k6)(()=>[(0,a.bF)(J)]),_:1}),t[21]||(t[21]=(0,a.eW)(" 邀请成员 ",-1))]),_:1})):(0,a.Q3)("",!0)]),(0,a.bF)(Z,{data:x.members,style:{width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(q,{prop:"userName",label:"用户名",width:"120"}),(0,a.bF)(q,{prop:"realName",label:"姓名",width:"120"}),(0,a.bF)(q,{prop:"studentId",label:"学号/工号",width:"120"}),(0,a.bF)(q,{prop:"department",label:"院系",width:"150"}),(0,a.bF)(q,{prop:"role",label:"角色",width:"100"},{default:(0,a.k6)(e=>[(0,a.bF)(Y,{type:"LEADER"===e.row.role?"danger":"primary"},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)("LEADER"===e.row.role?"负责人":"成员"),1)]),_:2},1032,["type"])]),_:1}),(0,a.bF)(q,{prop:"joinTime",label:"加入时间","min-width":"180"}),(0,a.bF)(q,{label:"操作",width:"120",fixed:"right"},{default:(0,a.k6)(e=>[x.canEdit&&"LEADER"!==e.row.role?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"danger",size:"small",onClick:t=>x.handleRemoveMember(e.row)},{default:(0,a.k6)(()=>[...t[23]||(t[23]=[(0,a.eW)(" 移除 ",-1)])]),_:1},8,["onClick"])):(0,a.Q3)("",!0)]),_:1})]),_:1},8,["data"])])]),_:1}),(0,a.bF)(ee,{label:"项目阶段",name:"milestones"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",I,[(0,a.Lk)("div",D,[t[25]||(t[25]=(0,a.Lk)("h3",null,"项目阶段进度",-1)),x.canEdit&&"COMPLETED"!==x.project.status&&"CANCELLED"!==x.project.status&&0===x.milestones.length?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"primary",onClick:x.initProjectMilestones},{default:(0,a.k6)(()=>[(0,a.bF)(z,null,{default:(0,a.k6)(()=>[(0,a.bF)(J)]),_:1}),t[24]||(t[24]=(0,a.eW)(" 初始化项目阶段 ",-1))]),_:1},8,["onClick"])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",F,[(0,a.Lk)("div",C,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.predefinedMilestones,(l,o)=>((0,a.uX)(),(0,a.CE)("div",{key:l.key,class:(0,n.C4)(["milestone-node",{completed:"COMPLETED"===x.getMilestoneById(l.key)?.status,pending:"PENDING"===x.getMilestoneById(l.key)?.status,overdue:x.isMilestoneOverdue(x.getMilestoneById(l.key)),active:o===x.currentActiveMilestoneIndex}])},[(0,a.Lk)("div",M,[(0,a.Lk)("div",N,(0,n.v_)(o+1),1),(0,a.Lk)("div",_,[(0,a.Lk)("h4",null,(0,n.v_)(l.name),1),(0,a.Lk)("div",A," 截止日期: "+(0,n.v_)(x.getMilestoneById(l.key)?.dueDate?x.getMilestoneById(l.key).dueDate:"未设置"),1)]),x.getMilestoneById(l.key)?((0,a.uX)(),(0,a.Wv)(Y,{key:0,type:x.getMilestoneStatusTag(x.getMilestoneById(l.key).status)},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(x.getMilestoneStatusName(x.getMilestoneById(l.key).status)),1)]),_:2},1032,["type"])):(0,a.Q3)("",!0),!x.canEdit||"COMPLETED"===x.project.status||"CANCELLED"===x.project.status||x.getMilestoneById(l.key)&&!["PENDING","OVERDUE"].includes(x.getMilestoneById(l.key).status)?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)(Q,{key:1,type:"text",size:"small",onClick:e=>x.editMilestone(x.getMilestoneById(l.key)||{key:l.key,name:l.name})},{default:(0,a.k6)(()=>[(0,a.eW)((0,n.v_)(x.getMilestoneById(l.key)?"编辑":"添加"),1)]),_:2},1032,["onClick"]))]),x.getMilestoneById(l.key)?((0,a.uX)(),(0,a.CE)("div",j,[(0,a.Lk)("div",T,[t[26]||(t[26]=(0,a.Lk)("strong",null,"阶段描述:",-1)),(0,a.Lk)("p",null,(0,n.v_)(x.getMilestoneById(l.key).description||"无描述"),1)]),"midterm"!==l.key&&"conclusion"!==l.key||!x.canEdit?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",O,[t[28]||(t[28]=(0,a.Lk)("strong",null,"相关文件:",-1)),(0,a.bF)(le,{class:"upload-demo",action:x.uploadUrl,headers:{Authorization:`Bearer ${x.token}`},"on-success":e.handleMilestoneFileUploadSuccess,"on-error":x.handleFileUploadError,data:x.getMilestoneUploadData(l.key),disabled:!x.canEdit||"COMPLETED"===x.project.status||"CANCELLED"===x.project.status,drag:""},{default:(0,a.k6)(()=>[(0,a.bF)(z,{class:"el-icon--upload"},{default:(0,a.k6)(()=>[(0,a.bF)(te)]),_:1}),t[27]||(t[27]=(0,a.Lk)("div",{class:"el-upload__text"},[(0,a.eW)("拖拽文件到此处或 "),(0,a.Lk)("em",null,"点击上传")],-1))]),_:1},8,["action","headers","on-success","on-error","data","disabled"]),x.getMilestoneFiles(l.key).length>0?((0,a.uX)(),(0,a.CE)("div",B,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.getMilestoneFiles(l.key),e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"file-item"},[(0,a.Lk)("a",{href:e.fileUrl,target:"_blank"},(0,n.v_)(e.fileName),9,W),(0,a.bF)(Q,{type:"danger",size:"small",icon:"Delete",onClick:t=>x.handleDeleteFile(e)},null,8,["onClick"])]))),128))])):(0,a.Q3)("",!0)])),x.canEdit&&"COMPLETED"!==x.project.status&&"CANCELLED"!==x.project.status?((0,a.uX)(),(0,a.CE)("div",P,["COMPLETED"!==x.getMilestoneById(l.key).status?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"primary",size:"small",onClick:e=>x.handleUpdateMilestoneStatus(x.getMilestoneById(l.key),"COMPLETED")},{default:(0,a.k6)(()=>[...t[29]||(t[29]=[(0,a.eW)(" 标记为完成 ",-1)])]),_:1},8,["onClick"])):(0,a.Q3)("",!0),"COMPLETED"===x.getMilestoneById(l.key).status?((0,a.uX)(),(0,a.Wv)(Q,{key:1,type:"warning",size:"small",onClick:e=>x.handleUpdateMilestoneStatus(x.getMilestoneById(l.key),"PENDING")},{default:(0,a.k6)(()=>[...t[30]||(t[30]=[(0,a.eW)(" 标记为待完成 ",-1)])]),_:1},8,["onClick"])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)],2))),128))])])])]),_:1}),(0,a.bF)(ee,{label:"项目文件",name:"files"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",R,[(0,a.Lk)("div",S,[(0,a.bF)(le,{class:"upload-demo",action:x.uploadUrl,headers:x.uploadHeaders,"on-success":x.handleFileUploadSuccess,"on-error":x.handleFileUploadError,data:x.getGeneralUploadData(),disabled:!x.canEdit||"COMPLETED"===x.project.status||"CANCELLED"===x.project.status,drag:""},{default:(0,a.k6)(()=>[(0,a.bF)(z,{class:"el-icon--upload"},{default:(0,a.k6)(()=>[(0,a.bF)(te)]),_:1}),t[31]||(t[31]=(0,a.Lk)("div",{class:"el-upload__text"},[(0,a.eW)("拖拽文件到此处或 "),(0,a.Lk)("em",null,"点击上传")],-1)),t[32]||(t[32]=(0,a.Lk)("div",{class:"el-upload__tip"}," 支持上传中期报告、结题材料等项目相关文件 ",-1))]),_:1},8,["action","headers","on-success","on-error","data","disabled"])]),t[34]||(t[34]=(0,a.Lk)("h3",null,"文件列表",-1)),t[35]||(t[35]=(0,a.Lk)("br",null,null,-1)),(0,a.bF)(Z,{data:x.files,style:{width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(q,{prop:"fileName",label:"文件名","min-width":"250"},{default:(0,a.k6)(e=>[(0,a.Lk)("a",{href:e.row.fileUrl,target:"_blank"},(0,n.v_)(e.row.fileName),9,U)]),_:1}),(0,a.bF)(q,{prop:"fileSize",label:"文件大小",width:"100"},{default:(0,a.k6)(e=>[(0,a.eW)((0,n.v_)(x.formatFileSize(e.row.fileSize)),1)]),_:1}),(0,a.bF)(q,{prop:"fileType",label:"文件类型",width:"100"}),(0,a.bF)(q,{prop:"uploaderName",label:"上传者",width:"120"}),(0,a.bF)(q,{prop:"uploadTime",label:"上传时间",width:"180"}),(0,a.bF)(q,{label:"操作",width:"120",fixed:"right"},{default:(0,a.k6)(e=>[x.canEdit?((0,a.uX)(),(0,a.Wv)(Q,{key:0,type:"danger",size:"small",onClick:t=>x.handleDeleteFile(e.row)},{default:(0,a.k6)(()=>[...t[33]||(t[33]=[(0,a.eW)(" 删除 ",-1)])]),_:1},8,["onClick"])):(0,a.Q3)("",!0)]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(ie,{title:"邀请成员",modelValue:x.showInviteDialog,"onUpdate:modelValue":t[4]||(t[4]=e=>x.showInviteDialog=e),width:"600px"},{footer:(0,a.k6)(()=>[(0,a.Lk)("span",V,[(0,a.bF)(Q,{onClick:t[3]||(t[3]=e=>x.showInviteDialog=!1)},{default:(0,a.k6)(()=>[...t[36]||(t[36]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(Q,{type:"primary",onClick:x.handleInviteMember},{default:(0,a.k6)(()=>[...t[37]||(t[37]=[(0,a.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.bF)(se,{model:x.inviteForm,rules:x.inviteRules,ref:"inviteFormRef"},{default:(0,a.k6)(()=>[(0,a.bF)(re,{label:"选择学生",prop:"userId"},{default:(0,a.k6)(()=>[(0,a.bF)(oe,{modelValue:x.inviteForm.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>x.inviteForm.userId=e),placeholder:"请选择学生",style:{width:"100%"},"show-search":"","filter-method":x.filterStudentMethod,clearable:""},{default:(0,a.k6)(()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.availableStudents,e=>((0,a.uX)(),(0,a.Wv)(ne,{key:e.id,label:`${e.realName} (${e.studentId})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","filter-method"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,a.bF)(ie,{title:x.editingMilestone?"编辑阶段":"添加阶段",modelValue:x.showAddMilestoneDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>x.showAddMilestoneDialog=e),width:"600px"},{footer:(0,a.k6)(()=>[(0,a.Lk)("span",$,[(0,a.bF)(Q,{onClick:t[8]||(t[8]=e=>x.showAddMilestoneDialog=!1)},{default:(0,a.k6)(()=>[...t[38]||(t[38]=[(0,a.eW)("取消",-1)])]),_:1}),(0,a.bF)(Q,{type:"primary",onClick:x.handleSaveMilestone},{default:(0,a.k6)(()=>[...t[39]||(t[39]=[(0,a.eW)("确定",-1)])]),_:1},8,["onClick"])])]),default:(0,a.k6)(()=>[(0,a.bF)(se,{model:x.milestoneForm,rules:x.milestoneRules,ref:"milestoneFormRef"},{default:(0,a.k6)(()=>[(0,a.bF)(re,{label:"阶段名称",prop:"name"},{default:(0,a.k6)(()=>[(0,a.bF)(ue,{modelValue:x.milestoneForm.name,"onUpdate:modelValue":t[5]||(t[5]=e=>x.milestoneForm.name=e),placeholder:"请输入阶段名称",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,a.bF)(re,{label:"截止日期",prop:"dueDate"},{default:(0,a.k6)(()=>[(0,a.bF)(de,{modelValue:x.milestoneForm.dueDate,"onUpdate:modelValue":t[6]||(t[6]=e=>x.milestoneForm.dueDate=e),type:"date",placeholder:"选择截止日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),(0,a.bF)(re,{label:"阶段描述",prop:"description"},{default:(0,a.k6)(()=>[(0,a.bF)(ue,{modelValue:x.milestoneForm.description,"onUpdate:modelValue":t[7]||(t[7]=e=>x.milestoneForm.description=e),type:"textarea",rows:4,placeholder:"请输入阶段描述",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}var K=l(953),X=l(5220),G=l(163),z=l(7918),Q=l(6698),Y=(l(1356),l(7518)),H={name:"ProjectDetail",setup(){const e=(0,X.rd)(),t=(0,X.lq)(),l=(0,a.EW)(()=>t.params.id),n=(0,K.KR)(!1),o=(0,K.Kh)({}),r=(0,K.KR)([]),s=(0,K.KR)([]),i=(0,K.KR)([]),u=(0,K.KR)([]),d=(0,K.KR)("members"),c=(0,K.KR)(!1),m=(0,K.KR)(!1),p=(0,K.KR)(null),k=(0,K.Kh)({userId:""}),f=(0,K.Kh)({name:"",dueDate:"",description:"",key:""}),g=[{key:"proposal",name:"项目立项"},{key:"literature",name:"文献调研"},{key:"design",name:"方案设计与开发"},{key:"midterm",name:"中期检查"},{key:"achievements",name:"成果整理"},{key:"conclusion",name:"结题验收"}],v=(0,K.KR)(),y=(0,K.KR)(),h={userId:[{required:!0,message:"请选择学生",trigger:"change"}]},b={name:[{required:!0,message:"请输入阶段名称",trigger:"blur"},{min:2,max:200,message:"名称长度在2到200个字符",trigger:"blur"}],dueDate:[{required:!0,message:"请选择截止日期",trigger:"change"}],description:[{required:!0,message:"请输入阶段描述",trigger:"blur"},{min:5,max:500,message:"描述长度在5到500个字符",trigger:"blur"}]},E=(0,a.EW)(()=>Y.A.getters.token),L=()=>{try{const e=localStorage.getItem("userInfo");return e?JSON.parse(e):(console.warn("localStorage中未找到userInfo"),{id:2,roles:["ADMIN"]})}catch(e){return console.error("解析userInfo失败:",e),{id:2,roles:["ADMIN"]}}},w=(0,a.EW)(()=>{const e=L();return console.log("用户信息:",e),e?.id||""}),I=(0,a.EW)(()=>{const e=L();return e?.roles?.[0]||""}),D=(0,a.EW)(()=>{try{const e=Number(w.value)||0,t=I.value||"",l=Number(o.leaderId)||0,a="ADMIN"===t,n=e===l,r=a||n;return console.log("canEdit计算:",{currentUserId:e,role:t,projectLeaderId:l,isAdmin:a,isProjectLeader:n,result:r}),Boolean(r)}catch(e){return console.error("计算canEdit时出错:",e),!0}}),F=()=>{L();console.log("验证用户状态:"),console.log("1. localStorage中是否有userInfo:",!!localStorage.getItem("userInfo")),console.log("2. 用户ID:",w.value),console.log("3. 用户角色:",I.value),console.log("4. 项目负责人ID:",o.leaderId),console.log("5. canEdit值:",D.value)},C=(0,a.EW)(()=>`/api/projects/${l.value}/files`),M=e=>{const t={RESEARCH:"研究项目",INNOVATION:"创新项目",PRACTICE:"实践项目"};return t[e]||e},N=e=>{const t={RESEARCH:"primary",INNOVATION:"success",PRACTICE:"warning"};return t[e]||"info"},_=e=>{const t={NATIONAL:"国家级",PROVINCIAL:"省级",SCHOOL:"校级"};return t[e]||e},A=e=>{const t={NATIONAL:"danger",PROVINCIAL:"warning",SCHOOL:"success"};return t[e]||"info"},j=e=>{const t={PLANNING:"规划中",ONGOING:"进行中",ACTIVE:"进行中",COMPLETED:"已完成",CANCELLED:"已取消"};return t[e]||e},T=e=>{const t={PLANNING:"info",ONGOING:"success",ACTIVE:"success",COMPLETED:"warning",CANCELLED:"danger"};return t[e]||"info"},O=e=>{const t={PENDING:"待完成",COMPLETED:"已完成",OVERDUE:"已逾期"};return t[e]||e},B=e=>{const t={PENDING:"warning",COMPLETED:"success",OVERDUE:"danger"};return t[e]||"info"},W=e=>{if(!e)return null;let t=s.value.find(t=>t.key===e);if(!t){const l=g.find(t=>t.key===e);l&&(t=s.value.find(e=>e.name===l.name),t||(t=s.value.find(e=>e.name&&e.name.includes(l.name))))}if(!t&&1===s.value.length){const l=g.find(t=>t.key===e);l&&(t=s.value[0])}return t},P=e=>{if(!e||!e.dueDate||"COMPLETED"===e.status)return!1;const t=new Date(e.dueDate),l=new Date;return t<l},R=(0,a.EW)(()=>{const e=s.value.filter(e=>"COMPLETED"===e.status);if(0===e.length)return 0;const t=e[e.length-1].key,l=g.findIndex(e=>e.key===t);return l===g.length-1?l:l+1}),S=e=>i.value.filter(t=>t.milestoneKey===e),U=async()=>{try{for(const e of g){const t=W(e.key);t||await(0,Q.jh)(l.value,{name:e.name,key:e.key,status:"PENDING"})}await J(),G.nk.success("项目阶段初始化成功")}catch(e){console.error("初始化项目阶段失败:",e),G.nk.error("初始化项目阶段失败")}},V=e=>{if(!e)return"0 B";const t=["B","KB","MB","GB","TB"];let l=0;while(e>=1024&&l<t.length-1)e/=1024,l++;return`${e.toFixed(2)} ${t[l]}`},$=async()=>{n.value=!0;try{const a=await(0,Q.G6)(l.value);if(Object.assign(o,a.data||a),console.log("项目详情:",o),o.leaderId&&!o.leaderName)try{const t=await(0,Q.hr)(l.value),a=Array.isArray(t)?t:t?.data||[],n=a.find(e=>e.userId===o.leaderId);if(n&&n.realName)o.leaderName=n.realName;else try{const e=await(0,Q.J2)(o.leaderId),t=e.data||e;t.realName?o.leaderName=t.realName:o.leaderName="未知负责人"}catch(e){console.warn("获取用户信息失败:",e),o.leaderName="未知负责人"}}catch(t){console.warn("获取成员列表失败:",t),o.leaderName="未知负责人"}}catch(a){console.error("加载项目详情失败:",a),G.nk.error("加载项目详情失败")}finally{n.value=!1}},x=async()=>{try{const e=await(0,Q.hr)(l.value);console.log("项目成员响应:",e);let t=Array.isArray(e)?e:e?.data||[];const a=await Promise.all(t.map(async e=>{try{const t=await(0,Q.J2)(e.userId);console.log("获取成员用户信息:",t);const l=t?.data||t;return{...e,realName:l.realName||"未知",studentId:l.studentId||l.teacherId||"未知",department:l.department||"未知"}}catch(t){return console.error(`获取用户${e.userId}信息失败:`,t),{...e,realName:"未知",studentId:"未知",department:"未知"}}}));r.value=a}catch(e){console.error("加载项目成员失败:",e),G.nk.error("加载项目成员失败"),r.value=[]}},H=async()=>{try{const e=await(0,Q.iz)(),t=Array.isArray(e)?e:e?.data||[],l=r.value.map(e=>e.userId);u.value=t.filter(e=>!l.includes(e.id))}catch(e){console.error("加载学生列表失败:",e),G.nk.error("加载学生列表失败"),u.value=[]}},J=async()=>{try{console.log("开始获取项目阶段数据，项目ID:",l.value);const e=Date.now(),t=await(0,Q.jY)(l.value),a=Date.now();console.log(`API调用耗时: ${a-e}ms`),console.log("API返回原始响应:",JSON.stringify(t)),console.log("响应类型:",typeof t),console.log("响应是否有data属性:",t&&t.hasOwnProperty("data")),console.log("data属性类型:",t&&typeof t.data),s.value=Array.isArray(t)?t:t?.data||[],console.log("处理后的项目阶段数据:",JSON.stringify(s.value)),console.log("阶段数据长度:",s.value.length),s.value.length>0&&(console.log("第一条阶段数据详情:",JSON.stringify(s.value[0])),console.log("是否包含dueDate字段:",s.value[0].hasOwnProperty("dueDate")))}catch(e){console.error("加载项目阶段失败:",e),console.error("错误详情:",e.response?JSON.stringify(e.response):e.message),G.nk.error("加载项目阶段失败"),s.value=[]}},q=async()=>{try{const e=await(0,Q.Rv)(l.value);i.value=Array.isArray(e)?e:e?.data||[]}catch(e){console.error("加载项目文件失败:",e),G.nk.error("加载项目文件失败"),i.value=[]}},Z=async()=>{v.value&&await v.value.validate(async e=>{if(e)try{await(0,Q.pH)(l.value,k.userId),G.nk.success("邀请成员成功"),c.value=!1,await x(),await H(),k.userId=""}catch(t){console.error("邀请成员失败:",t),G.nk.error("邀请成员失败")}})},ee=async e=>{z.s.confirm("确定要移除该成员吗？","确认移除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,Q.wV)(l.value,e.userId),G.nk.success("移除成员成功"),await x(),await H()}catch(t){console.error("移除成员失败:",t),G.nk.error("移除成员失败")}})},te=e=>{p.value=e,Object.assign(f,{name:e.name,dueDate:e.dueDate||"",description:e.description||"",key:e.key}),m.value=!0},le=async()=>{y.value&&await y.value.validate(async e=>{if(e)try{const e={...f};let t=null;if(p.value){if(p.value.key){const e=s.value.find(e=>{const t=W(p.value.key);return t&&t.id});e&&W(p.value.key)&&(t=W(p.value.key).id)}p.value.id&&(t=p.value.id)}t?(await(0,Q.CE)(l.value,t,e),G.nk.success("更新阶段成功")):(await(0,Q.jh)(l.value,e),G.nk.success("添加阶段成功")),m.value=!1,await J(),p.value=null,f.name="",f.dueDate="",f.description="",f.key=""}catch(t){console.error("保存阶段失败:",t);const e=t.response?.data?.msg||"保存阶段失败";G.nk.error(e)}})},ae=async(e,t)=>{let a="";"COMPLETED"===t?a="已完成":"PENDING"===t?a="待完成":"OVERDUE"===t&&(a="已逾期"),z.s.confirm(`确定要将该阶段标记为${a}吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,Q.CE)(l.value,e.id,{status:t}),G.nk.success("更新阶段状态成功"),await J()}catch(a){console.error("更新阶段状态失败:",a);const e=a.response?.data?.msg||"更新阶段状态失败";G.nk.error(e)}})},ne=async e=>{G.nk.warning("预定义阶段不允许删除，请编辑或更新状态")},oe=async()=>{G.nk.success("文件上传成功"),await q()},re=()=>{G.nk.error("文件上传失败")},se=async e=>{z.s.confirm("确定要删除该文件吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await(0,Q.nB)(l.value,e.id),G.nk.success("删除文件成功"),await q()}catch(t){console.error("删除文件失败:",t),G.nk.error("删除文件失败")}})},ie=()=>{e.push(`/dashboard/projects/${l.value}/edit`)},ue=(e,t)=>{const l=t.label||"";return l.toLowerCase().includes(e.toLowerCase())},de=()=>{e.push("/dashboard/projects")};(0,a.wB)(c,e=>{e&&H()}),(0,a.wB)(m,e=>{!e&&y.value&&(y.value.resetFields(),p.value=null,f.name="",f.dueDate="",f.description="")}),(0,a.wB)(d,e=>{"members"===e?x():"milestones"===e?J():"files"===e&&q()}),(0,a.sV)(async()=>{await $(),await x(),await J(),await q(),setTimeout(()=>{F()},500)});const ce=(0,a.EW)(()=>{const e=Y.A.getters.token;return console.log("上传文件时的Token:",e),{Authorization:`Bearer ${e}`}}),me=(0,a.EW)(()=>({projectId:l.value,milestoneId:"",milestoneKey:"",uploaderId:w.value})),pe=e=>{const t=W(e);return{projectId:l.value,milestoneId:t?t.id:0,milestoneKey:e,uploaderId:w.value}},ke=()=>({projectId:l.value,milestoneId:0,uploaderId:w.value});return{loading:n,project:o,members:r,milestones:s,files:i,availableStudents:u,activeTab:d,showInviteDialog:c,showAddMilestoneDialog:m,editingMilestone:p,inviteForm:k,predefinedMilestones:g,milestoneForm:f,inviteRules:h,milestoneRules:b,inviteFormRef:v,milestoneFormRef:y,token:E,canEdit:D,uploadUrl:C,currentActiveMilestoneIndex:R,uploadHeaders:ce,uploadData:me,getTypeName:M,getTypeTag:N,getLevelName:_,getLevelTag:A,getStatusName:j,getStatusTag:T,getMilestoneStatusName:O,getMilestoneStatusTag:B,getMilestoneById:W,isMilestoneOverdue:P,getMilestoneFiles:S,initProjectMilestones:U,formatFileSize:V,handleInviteMember:Z,handleRemoveMember:ee,editMilestone:te,handleSaveMilestone:le,handleUpdateMilestoneStatus:ae,handleDeleteMilestone:ne,handleFileUploadSuccess:oe,handleFileUploadError:re,handleDeleteFile:se,handleEdit:ie,handleBack:de,validateUserStatus:F,filterStudentMethod:ue,getMilestoneUploadData:pe,getGeneralUploadData:ke}}},J=l(6262);const q=(0,J.A)(H,[["render",x],["__scopeId","data-v-43480da2"]]);var Z=q}}]);
//# sourceMappingURL=175.62cccaad.js.map