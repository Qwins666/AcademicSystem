"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[127],{6127:function(a,e,l){l.r(e),l.d(e,{default:function(){return Z}});var s=l(641),t=l(33);const r={class:"achievement-detail"},p={class:"page-header"},n={key:0,class:"loading-container"},v={key:1,class:"detail-card"},o={class:"card-header"},i={class:"status-tag"},c={class:"detail-content"},u={class:"info-row"},d={class:"info-row"},m={key:1},k={class:"info-row"},f={class:"value"},g={class:"info-row"},L={class:"value"},h={class:"info-row"},A={class:"value description"},N={class:"info-row"},y={class:"value"},E={key:1},b={key:0,class:"approval-info"},T={key:0,class:"approval-section"},_={class:"approval-content"},I={class:"approval-item"},C={class:"approval-item"},w={class:"approval-value"},D={class:"approval-item"},P={class:"approval-value"},R={class:"approval-item"},F={class:"approval-value"},O={key:1,class:"approval-section"},W={class:"approval-content"},X={class:"approval-item"},$={class:"approval-item"},S={class:"approval-value"},V={class:"approval-item"},G={class:"approval-value"},J={class:"approval-item"},H={class:"approval-value"},K={key:2,class:"empty-container"};function Q(a,e,l,Q,U,z){const B=(0,s.g2)("el-button"),M=(0,s.g2)("el-skeleton"),j=(0,s.g2)("el-tag"),q=(0,s.g2)("el-card"),x=(0,s.g2)("el-empty");return(0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",p,[e[1]||(e[1]=(0,s.Lk)("h2",null,"成果详情",-1)),(0,s.bF)(B,{type:"primary",onClick:Q.handleBack},{default:(0,s.k6)(()=>[...e[0]||(e[0]=[(0,s.eW)("返回列表",-1)])]),_:1},8,["onClick"])]),Q.loading?((0,s.uX)(),(0,s.CE)("div",n,[(0,s.bF)(M,{rows:10,animated:""})])):Q.achievement?((0,s.uX)(),(0,s.CE)("div",v,[(0,s.bF)(q,{shadow:"hover"},{header:(0,s.k6)(()=>[(0,s.Lk)("div",o,[(0,s.Lk)("h3",null,(0,t.v_)(Q.achievement.title),1),(0,s.Lk)("div",i,[(0,s.bF)(j,{type:Q.getStatusTag(Q.achievement.status)},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Q.getStatusName(Q.achievement.status)),1)]),_:1},8,["type"])])])]),default:(0,s.k6)(()=>[(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[e[2]||(e[2]=(0,s.Lk)("span",{class:"label"},"成果类型：",-1)),(0,s.bF)(j,{type:Q.getTypeTag(Q.achievement.type)},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Q.getTypeName(Q.achievement.type)),1)]),_:1},8,["type"])]),(0,s.Lk)("div",d,[e[3]||(e[3]=(0,s.Lk)("span",{class:"label"},"级别：",-1)),Q.achievement.level?((0,s.uX)(),(0,s.Wv)(j,{key:0,type:Q.getLevelTag(Q.achievement.level)},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Q.getLevelName(Q.achievement.level)),1)]),_:1},8,["type"])):((0,s.uX)(),(0,s.CE)("span",m,"-"))]),(0,s.Lk)("div",k,[e[4]||(e[4]=(0,s.Lk)("span",{class:"label"},"提交者：",-1)),(0,s.Lk)("span",f,(0,t.v_)(Q.achievement.submitterName||"未知"),1)]),(0,s.Lk)("div",g,[e[5]||(e[5]=(0,s.Lk)("span",{class:"label"},"提交时间：",-1)),(0,s.Lk)("span",L,(0,t.v_)(Q.formatDateTime(Q.achievement.createTime)),1)]),(0,s.Lk)("div",h,[e[6]||(e[6]=(0,s.Lk)("span",{class:"label"},"成果描述：",-1)),(0,s.Lk)("div",A,(0,t.v_)(Q.achievement.description||"-"),1)]),(0,s.Lk)("div",N,[e[8]||(e[8]=(0,s.Lk)("span",{class:"label"},"相关附件：",-1)),(0,s.Lk)("div",y,[Q.achievement.fileUrl?((0,s.uX)(),(0,s.Wv)(B,{key:0,type:"primary",size:"small",onClick:Q.handleDownload,icon:"DocumentDownload"},{default:(0,s.k6)(()=>[...e[7]||(e[7]=[(0,s.eW)(" 下载附件 ",-1)])]),_:1},8,["onClick"])):((0,s.uX)(),(0,s.CE)("span",E,"-"))])]),Q.showApprovalInfo?((0,s.uX)(),(0,s.CE)("div",b,[e[19]||(e[19]=(0,s.Lk)("h4",null,"审核信息",-1)),Q.achievement.firstApproval?((0,s.uX)(),(0,s.CE)("div",T,[e[13]||(e[13]=(0,s.Lk)("div",{class:"approval-title"},"初审：",-1)),(0,s.Lk)("div",_,[(0,s.Lk)("div",I,[e[9]||(e[9]=(0,s.Lk)("span",{class:"approval-label"},"审核结果：",-1)),(0,s.bF)(j,{type:Q.achievement.firstApproval.approved?"success":"danger"},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Q.achievement.firstApproval.approved?"通过":"驳回"),1)]),_:1},8,["type"])]),(0,s.Lk)("div",C,[e[10]||(e[10]=(0,s.Lk)("span",{class:"approval-label"},"审核意见：",-1)),(0,s.Lk)("span",w,(0,t.v_)(Q.achievement.firstApproval.comment||"-"),1)]),(0,s.Lk)("div",D,[e[11]||(e[11]=(0,s.Lk)("span",{class:"approval-label"},"审核时间：",-1)),(0,s.Lk)("span",P,(0,t.v_)(Q.formatDateTime(Q.achievement.firstApproval.approvalTime)),1)]),(0,s.Lk)("div",R,[e[12]||(e[12]=(0,s.Lk)("span",{class:"approval-label"},"审核人：",-1)),(0,s.Lk)("span",F,(0,t.v_)(Q.achievement.firstApproval.approverName||"未知"),1)])])])):(0,s.Q3)("",!0),Q.achievement.finalApproval?((0,s.uX)(),(0,s.CE)("div",O,[e[18]||(e[18]=(0,s.Lk)("div",{class:"approval-title"},"终审：",-1)),(0,s.Lk)("div",W,[(0,s.Lk)("div",X,[e[14]||(e[14]=(0,s.Lk)("span",{class:"approval-label"},"审核结果：",-1)),(0,s.bF)(j,{type:Q.achievement.finalApproval.approved?"success":"danger"},{default:(0,s.k6)(()=>[(0,s.eW)((0,t.v_)(Q.achievement.finalApproval.approved?"通过":"驳回"),1)]),_:1},8,["type"])]),(0,s.Lk)("div",$,[e[15]||(e[15]=(0,s.Lk)("span",{class:"approval-label"},"审核意见：",-1)),(0,s.Lk)("span",S,(0,t.v_)(Q.achievement.finalApproval.comment||"-"),1)]),(0,s.Lk)("div",V,[e[16]||(e[16]=(0,s.Lk)("span",{class:"approval-label"},"审核时间：",-1)),(0,s.Lk)("span",G,(0,t.v_)(Q.formatDateTime(Q.achievement.finalApproval.approvalTime)),1)]),(0,s.Lk)("div",J,[e[17]||(e[17]=(0,s.Lk)("span",{class:"approval-label"},"审核人：",-1)),(0,s.Lk)("span",H,(0,t.v_)(Q.achievement.finalApproval.approverName||"未知"),1)])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])]),_:1})])):((0,s.uX)(),(0,s.CE)("div",K,[(0,s.bF)(x,{description:"未找到成果信息"})]))])}var U=l(953),z=l(5220),B=l(6278),M=l(163),j=l(86),q={name:"AchievementDetail",setup(){const a=(0,z.rd)(),e=(0,z.lq)(),l=(0,B.Pj)(),t=(0,U.KR)(!0),r=(0,U.KR)(null),p=(0,U.KR)(new Map),n=(0,s.EW)(()=>l.getters.userRole),v=(0,s.EW)(()=>l.getters.user?.id),o=(0,s.EW)(()=>"ADMIN"===n.value||"TEACHER"===n.value||r.value&&r.value.submitterId===v.value),i=a=>{if(!a)return"-";const e=new Date(a);return isNaN(e.getTime())?a:e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})},c=a=>{const e={PAPER:"论文",PATENT:"专利",CERTIFICATE:"证书",PROJECT:"项目"};return e[a]||a},u=a=>{const e={PAPER:"primary",PATENT:"success",CERTIFICATE:"warning",PROJECT:"info"};return e[a]||"info"},d=a=>{const e={NATIONAL:"国家级",PROVINCIAL:"省级",SCHOOL:"校级"};return e[a]||a},m=a=>{const e={NATIONAL:"danger",PROVINCIAL:"warning",SCHOOL:"success"};return e[a]||"info"},k=a=>{const e={PENDING:"待审核",PENDING_FINAL:"待终审",APPROVED:"已通过",REJECTED:"已驳回"};return e[a]||a},f=a=>{const e={PENDING:"warning",PENDING_FINAL:"success",APPROVED:"success",REJECTED:"danger"};return e[a]||"info"},g=async a=>{if(p.value.has(a))return console.log("从缓存中获取的用户信息:",p.value.get(a)),p.value.get(a);try{console.log(`开始获取用户${a}信息`);const e=await j.A.get(`/users/basic/${a}`);console.log(`获取用户${a}信息成功:`,e);const l=e?.data||e;return p.value.set(a,l),l}catch(e){return console.error(`获取用户${a}信息失败:`,e),{realName:"未知用户",username:"未知用户"}}},L=async()=>{t.value=!0;try{const a=e.params.id,l=await j.A.get(`/achievements/${a}`);if(200===l.code){if(r.value=l.data||l,r.value.submitterId&&!r.value.submitterName){const a=await g(r.value.submitterId);r.value.submitterName=a.realName||a.username||"未知用户"}if(r.value.firstApproval&&r.value.firstApproval.approverId){console.log(`尝试获取初审审核者ID: ${r.value.firstApproval.approverId} 的真实姓名`),console.log(`当前初审审核者姓名: ${r.value.firstApproval.approverName}`);const a=await g(r.value.firstApproval.approverId);console.log("获取到的用户信息:",a),r.value.firstApproval.approverName=a.realName||a.username||"未知用户",console.log(`更新后初审审核者姓名: ${r.value.firstApproval.approverName}`)}if(r.value.finalApproval&&r.value.finalApproval.approverId){console.log(`尝试获取终审审核者ID: ${r.value.finalApproval.approverId} 的真实姓名`),console.log(`当前终审审核者姓名: ${r.value.finalApproval.approverName}`);const a=await g(r.value.finalApproval.approverId);console.log("获取到的用户信息:",a),r.value.finalApproval.approverName=a.realName||a.username||"未知用户",console.log(`更新后终审审核者姓名: ${r.value.finalApproval.approverName}`)}}}catch(a){console.error("加载成果详情失败:",a),M.nk.error("加载成果详情失败: "+(a.response?.data?.message||"未知错误"))}finally{t.value=!1}},h=()=>{a.push("/dashboard/achievements")},A=()=>{r.value?.fileUrl?window.open(r.value.fileUrl,"_blank"):M.nk.warning("没有可下载的附件")};return(0,s.sV)(()=>{L()}),{loading:t,achievement:r,showApprovalInfo:o,formatDateTime:i,getTypeName:c,getTypeTag:u,getLevelName:d,getLevelTag:m,getStatusName:k,getStatusTag:f,handleBack:h,handleDownload:A}}},x=l(6262);const Y=(0,x.A)(q,[["render",Q],["__scopeId","data-v-9b16d58e"]]);var Z=Y}}]);
//# sourceMappingURL=127.3e2915ce.js.map