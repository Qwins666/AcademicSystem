"use strict";(self["webpackChunkacademic_management_frontend"]=self["webpackChunkacademic_management_frontend"]||[]).push([[215],{5565:function(e,a,l){l.d(a,{ec:function(){return d},iD:function(){return s},kz:function(){return o},r7:function(){return t}});var r=l(86);function s(e){return(0,r.A)({url:"/auth/login",method:"post",data:e})}function o(e){return(0,r.A)({url:"/auth/register",method:"post",data:e})}function d(e){return(0,r.A)({url:"/auth/change-password",method:"post",data:e})}function t(e){return(0,r.A)({url:"/auth/update-profile",method:"post",data:e})}},9215:function(e,a,l){l.r(a),l.d(a,{default:function(){return C}});var r=l(641),s=l(3751),o=l(33);const d={class:"profile"},t={class:"profile-content"},u={class:"profile-card"},n={class:"avatar-card"},m={class:"avatar-section"},i={class:"user-info"},p={class:"stats-section"},c={class:"stat-item"},g={class:"stat-value"},b={class:"stat-item"},F={class:"stat-value"},f={class:"stat-item"},w={class:"stat-value"},k={class:"password-card"};function v(e,a,l,v,h,_){const V=(0,r.g2)("el-input"),P=(0,r.g2)("el-form-item"),L=(0,r.g2)("el-radio"),R=(0,r.g2)("el-radio-group"),U=(0,r.g2)("el-button"),y=(0,r.g2)("el-form"),C=(0,r.g2)("el-col"),N=(0,r.g2)("el-avatar"),j=(0,r.g2)("el-row");return(0,r.uX)(),(0,r.CE)("div",d,[a[24]||(a[24]=(0,r.Lk)("div",{class:"page-header"},[(0,r.Lk)("h1",null,"个人中心")],-1)),(0,r.Lk)("div",t,[(0,r.bF)(j,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(C,{span:16},{default:(0,r.k6)(()=>[(0,r.Lk)("div",u,[a[16]||(a[16]=(0,r.Lk)("h3",null,"个人信息",-1)),(0,r.bF)(y,{ref:"formRef",model:v.userForm,rules:v.rules,"label-width":"120px",onSubmit:(0,s.D$)(v.handleUpdate,["prevent"])},{default:(0,r.k6)(()=>[(0,r.bF)(P,{label:"用户名",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.username,"onUpdate:modelValue":a[0]||(a[0]=e=>v.userForm.username=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"真实姓名",prop:"realName"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.realName,"onUpdate:modelValue":a[1]||(a[1]=e=>v.userForm.realName=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"邮箱",prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.email,"onUpdate:modelValue":a[2]||(a[2]=e=>v.userForm.email=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"手机号",prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.phone,"onUpdate:modelValue":a[3]||(a[3]=e=>v.userForm.phone=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"学号/工号",prop:"studentId"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.studentId,"onUpdate:modelValue":a[4]||(a[4]=e=>v.userForm.studentId=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"院系",prop:"department"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.department,"onUpdate:modelValue":a[5]||(a[5]=e=>v.userForm.department=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"专业",prop:"major"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.major,"onUpdate:modelValue":a[6]||(a[6]=e=>v.userForm.major=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"年级",prop:"grade"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.userForm.grade,"onUpdate:modelValue":a[7]||(a[7]=e=>v.userForm.grade=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"性别",prop:"gender"},{default:(0,r.k6)(()=>[(0,r.bF)(R,{modelValue:v.userForm.gender,"onUpdate:modelValue":a[8]||(a[8]=e=>v.userForm.gender=e)},{default:(0,r.k6)(()=>[(0,r.bF)(L,{label:1},{default:(0,r.k6)(()=>[...a[12]||(a[12]=[(0,r.eW)("男",-1)])]),_:1}),(0,r.bF)(L,{label:2},{default:(0,r.k6)(()=>[...a[13]||(a[13]=[(0,r.eW)("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(U,{type:"primary",loading:v.loading,onClick:v.handleUpdate},{default:(0,r.k6)(()=>[...a[14]||(a[14]=[(0,r.eW)(" 更新信息 ",-1)])]),_:1},8,["loading","onClick"]),(0,r.bF)(U,{onClick:v.handleReset},{default:(0,r.k6)(()=>[...a[15]||(a[15]=[(0,r.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","onSubmit"])])]),_:1}),(0,r.bF)(C,{span:8},{default:(0,r.k6)(()=>[(0,r.Lk)("div",n,[(0,r.Lk)("div",m,[(0,r.bF)(N,{size:120,src:v.userForm.avatar},{default:(0,r.k6)(()=>[(0,r.eW)((0,o.v_)(v.userForm.realName?v.userForm.realName.charAt(0):"U"),1)]),_:1},8,["src"]),(0,r.Lk)("div",i,[(0,r.Lk)("h3",null,(0,o.v_)(v.userForm.realName||v.userForm.username),1),(0,r.Lk)("p",null,(0,o.v_)(v.getRoleName(v.userRole)),1)])]),(0,r.Lk)("div",p,[a[20]||(a[20]=(0,r.Lk)("h4",null,"我的统计",-1)),(0,r.Lk)("div",c,[a[17]||(a[17]=(0,r.Lk)("span",{class:"stat-label"},"参与活动",-1)),(0,r.Lk)("span",g,(0,o.v_)(v.userStats.activities),1)]),(0,r.Lk)("div",b,[a[18]||(a[18]=(0,r.Lk)("span",{class:"stat-label"},"申报成果",-1)),(0,r.Lk)("span",F,(0,o.v_)(v.userStats.achievements),1)]),(0,r.Lk)("div",f,[a[19]||(a[19]=(0,r.Lk)("span",{class:"stat-label"},"参与项目",-1)),(0,r.Lk)("span",w,(0,o.v_)(v.userStats.projects),1)])])])]),_:1})]),_:1}),(0,r.Lk)("div",k,[a[23]||(a[23]=(0,r.Lk)("h3",null,"修改密码",-1)),(0,r.bF)(y,{ref:"passwordFormRef",model:v.passwordForm,rules:v.passwordRules,"label-width":"120px",onSubmit:(0,s.D$)(v.handleChangePassword,["prevent"])},{default:(0,r.k6)(()=>[(0,r.bF)(P,{label:"原密码",prop:"oldPassword"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.passwordForm.oldPassword,"onUpdate:modelValue":a[9]||(a[9]=e=>v.passwordForm.oldPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"新密码",prop:"newPassword"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.passwordForm.newPassword,"onUpdate:modelValue":a[10]||(a[10]=e=>v.passwordForm.newPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"确认密码",prop:"confirmPassword"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:v.passwordForm.confirmPassword,"onUpdate:modelValue":a[11]||(a[11]=e=>v.passwordForm.confirmPassword=e),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(U,{type:"primary",loading:v.passwordLoading,onClick:v.handleChangePassword},{default:(0,r.k6)(()=>[...a[21]||(a[21]=[(0,r.eW)(" 修改密码 ",-1)])]),_:1},8,["loading","onClick"]),(0,r.bF)(U,{onClick:v.handleResetPassword},{default:(0,r.k6)(()=>[...a[22]||(a[22]=[(0,r.eW)("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules","onSubmit"])])])])}var h=l(953),_=l(6278),V=l(163),P=l(5565),L=l(4432),R={name:"Profile",setup(){const e=(0,_.Pj)(),a=(0,h.KR)(),l=(0,h.KR)(),s=(0,h.KR)(!1),o=(0,h.KR)(!1),d=(0,r.EW)(()=>e.getters.user),t=(0,r.EW)(()=>e.getters.userRole),u=(0,h.Kh)({username:"",realName:"",email:"",phone:"",studentId:"",department:"",major:"",grade:"",gender:1,avatar:""}),n=(0,h.Kh)({oldPassword:"",newPassword:"",confirmPassword:""}),m=(0,h.Kh)({activities:5,achievements:3,projects:2}),i={realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},p=(e,a,l)=>{a!==n.newPassword?l(new Error("两次输入的密码不一致")):l()},c={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:p,trigger:"blur"}]},g=e=>{const a={STUDENT:"学生",TEACHER:"教师",ADMIN:"管理员"};return a[e]||e},b=()=>{d.value&&Object.assign(u,{username:d.value.username||"",realName:d.value.realName||"",email:d.value.email||"",phone:d.value.phone||"",studentId:d.value.studentId||"",department:d.value.department||"",major:d.value.major||"",grade:d.value.grade||"",gender:d.value.gender||1,avatar:d.value.avatar||""})},F=async()=>{a.value&&await a.value.validate(async a=>{if(a){s.value=!0;try{await(0,P.r7)(u),e.dispatch("updateUser",u),V.nk.success("信息更新成功")}catch(l){V.nk.error("更新失败: "+(l.response?.data?.message||l.message))}finally{s.value=!1}}})},f=()=>{b()},w=async()=>{l.value&&await l.value.validate(async e=>{if(e){o.value=!0;try{await(0,P.ec)({oldPassword:n.oldPassword,newPassword:n.newPassword}),V.nk.success("密码修改成功"),k(),setTimeout(()=>{L.A.push("/login")},1e3)}catch(a){V.nk.error("密码修改失败: "+(a.response?.data?.message||a.message))}finally{o.value=!1}}})},k=()=>{l.value&&l.value.resetFields()};return(0,r.sV)(()=>{b()}),{formRef:a,passwordFormRef:l,loading:s,passwordLoading:o,user:d,userRole:t,userForm:u,passwordForm:n,userStats:m,rules:i,passwordRules:c,getRoleName:g,handleUpdate:F,handleReset:f,handleChangePassword:w,handleResetPassword:k}}},U=l(6262);const y=(0,U.A)(R,[["render",v],["__scopeId","data-v-bd960cec"]]);var C=y}}]);
//# sourceMappingURL=215.1b5a53be.js.map